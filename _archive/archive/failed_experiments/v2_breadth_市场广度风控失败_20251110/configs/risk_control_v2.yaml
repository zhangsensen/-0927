# 风险控制 V2 配置
# ============================================================================
# 第二代风控：市场广度 + 波动目标 + 相关性监控
# ============================================================================

# ----------------------------------------------------------------------------
# 1. 市场广度监控 (Market Breadth) - 🟢 推荐启用
# ----------------------------------------------------------------------------
market_breadth:
  # 是否启用
  enabled: true
  
  # 最低广度阈值（有效信号占比）
  # 低于此值触发防守模式
  # 建议: 0.25-0.30（25-30% ETF信号有效）
  breadth_floor: 0.25
  
  # 最低有效得分（因子z-score阈值）
  # 默认0.0（正值即有效）
  score_threshold: 0.0
  
  # 防守模式仓位比例
  # 触发后降仓至此比例
  # 建议: 0.5（降至50%）
  defensive_scale: 0.5
  
  # 是否输出详细日志
  verbose: true

# ----------------------------------------------------------------------------
# 2. 波动率目标 (Volatility Targeting) - 🟡 可选启用
# ----------------------------------------------------------------------------
volatility_target:
  # 是否启用
  enabled: false  # 默认关闭，需回测验证后再开
  
  # 目标年化波动率
  # 超过此值时降杠杆
  # 建议: 0.30-0.35（30-35%）避免频繁触发
  target_vol: 0.30
  
  # 最小计算窗口
  min_window: 20
  
  # 仓位比例范围
  max_scale: 1.0  # 最大仓位（不加杠杆）
  min_scale: 0.3  # 最小仓位（最多降至30%）
  
  # 是否输出详细日志
  verbose: true

# ----------------------------------------------------------------------------
# 3. 因子相关性监控 (Correlation Clustering) - 🤷 低优先级
# ----------------------------------------------------------------------------
correlation_monitor:
  # 是否启用
  enabled: false  # 默认关闭，老项目已有静态去冗
  
  # 相关性阈值
  # 平均相关系数超过此值触发预警
  # 建议: 0.65-0.70（避免误杀正常相关）
  corr_threshold: 0.65
  
  # 计算窗口长度（天数）
  window: 20
  
  # 最小权重惩罚系数
  # 触发时最多减权多少
  # 例：0.5 = 最多减权50%
  min_penalty: 0.5
  
  # 是否输出详细日志
  verbose: true

# ----------------------------------------------------------------------------
# 4. 综合风控策略
# ----------------------------------------------------------------------------
combined_strategy:
  # 多个风控同时触发时的处理方式
  # - "min": 取最小scale（最保守）
  # - "multiply": scale相乘（叠加效果）
  # - "max": 取最大scale（最激进）
  mode: "min"
  
  # 是否启用综合风控
  # 若false，各模块独立运行，不叠加
  enabled: true

# ----------------------------------------------------------------------------
# 5. 回测与验证
# ----------------------------------------------------------------------------
backtest:
  # 是否生成风控触发日志
  log_triggers: true
  
  # 日志输出路径
  trigger_log_path: "results/risk_control_triggers.csv"
  
  # 是否生成对比报告
  # baseline vs 各风控模块单独 vs 综合
  generate_comparison: true
  
  # 对比报告路径
  comparison_report_path: "results/risk_control_comparison.csv"
