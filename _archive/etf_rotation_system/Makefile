# ETFè½®åŠ¨é‡åŒ–äº¤æ˜“ç³»ç»Ÿ Makefile

.PHONY: help install panel screen backtest wfo pipeline clean test

# é»˜è®¤ç›®æ ‡ï¼šæ˜¾ç¤ºå¸®åŠ©
help:
	@echo "=================================="
	@echo "ETFè½®åŠ¨ç³»ç»Ÿ - å¯ç”¨å‘½ä»¤"
	@echo "=================================="
	@echo ""
	@echo "ç¯å¢ƒç®¡ç†:"
	@echo "  make install       - å®‰è£…ä¾èµ–"
	@echo ""
	@echo "æ•°æ®æµç¨‹:"
	@echo "  make panel         - ç”Ÿæˆå› å­é¢æ¿"
	@echo "  make screen        - å› å­ç­›é€‰"
	@echo "  make backtest      - VBTå›æµ‹"
	@echo "  make wfo           - WFOä¼˜åŒ–"
	@echo ""
	@echo "å®Œæ•´æµç¨‹:"
	@echo "  make pipeline      - è¿è¡Œå®Œæ•´æµç¨‹"
	@echo ""
	@echo "ç»´æŠ¤:"
	@echo "  make clean         - æ¸…ç†ç¼“å­˜"
	@echo "  make test          - è¿è¡Œæµ‹è¯•"
	@echo ""

# å®‰è£…ä¾èµ–
install:
	@echo "ğŸ“¦ å®‰è£…ä¾èµ–..."
	pip install -r requirements.txt
	@echo "âœ… ä¾èµ–å®‰è£…å®Œæˆ"

# ç”Ÿæˆå› å­é¢æ¿
panel:
	@echo "ğŸ“Š ç”Ÿæˆå› å­é¢æ¿..."
	cd 01_æ¨ªæˆªé¢å»ºè®¾ && python3 generate_panel_refactored.py
	@echo "âœ… é¢æ¿ç”Ÿæˆå®Œæˆ"

# å› å­ç­›é€‰
screen:
	@echo "ğŸ”¬ å› å­ç­›é€‰..."
	cd 02_å› å­ç­›é€‰ && python3 run_etf_cross_section_configurable.py --config optimized_screening_config.yaml
	@echo "âœ… ç­›é€‰å®Œæˆ"

# VBTå›æµ‹
backtest:
	@echo "ğŸš€ VBTå›æµ‹..."
	cd 03_vbtå›æµ‹ && python3 parallel_backtest_configurable.py --config-file parallel_backtest_config.yaml
	@echo "âœ… å›æµ‹å®Œæˆ"

# WFOä¼˜åŒ–
wfo:
	@echo "ğŸ¯ WFOä¼˜åŒ–..."
	cd 03_vbt_wfo && python3 production_runner_optimized.py
	@echo "âœ… WFOå®Œæˆ"

# å®Œæ•´æµç¨‹
pipeline: panel screen wfo
	@echo ""
	@echo "=================================="
	@echo "ğŸ‰ å®Œæ•´æµç¨‹æ‰§è¡Œå®Œæˆï¼"
	@echo "=================================="
	@echo ""
	@echo "ç»“æœä½ç½®:"
	@echo "  é¢æ¿: data/results/panels/"
	@echo "  ç­›é€‰: data/results/screening/"
	@echo "  WFO:  data/results/vbtwfo/"
	@echo ""

# æ¸…ç†ç¼“å­˜
clean:
	@echo "ğŸ§¹ æ¸…ç†ç¼“å­˜..."
	find . -type d -name "__pycache__" -exec rm -rf {} + 2>/dev/null || true
	find . -type d -name ".numba_cache" -exec rm -rf {} + 2>/dev/null || true
	find . -type f -name "*.pyc" -delete 2>/dev/null || true
	find . -type f -name "*.pyo" -delete 2>/dev/null || true
	@echo "âœ… æ¸…ç†å®Œæˆ"

# è¿è¡Œæµ‹è¯•
test:
	@echo "ğŸ§ª è¿è¡Œæµ‹è¯•..."
	python3 test_full_pipeline.py
	@echo "âœ… æµ‹è¯•å®Œæˆ"

# æŸ¥çœ‹æœ€æ–°ç»“æœ
latest:
	@echo "ğŸ“ æœ€æ–°ç»“æœ:"
	@echo ""
	@echo "é¢æ¿:"
	@ls -lt data/results/panels/ | head -3
	@echo ""
	@echo "ç­›é€‰:"
	@ls -lt data/results/screening/ | head -3
	@echo ""
	@echo "WFO:"
	@ls -lt data/results/vbtwfo/ | head -3
