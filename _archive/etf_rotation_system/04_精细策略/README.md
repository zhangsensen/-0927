# ETFè½®åŠ¨ç²¾ç»†ç­–ç•¥ç³»ç»Ÿ

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

åŸºäºVBTæš´åŠ›å›æµ‹ç»“æœï¼ˆ10,000ç»„åˆï¼‰çš„ç²¾ç»†åŒ–ç­–ç•¥åˆ†æå’Œä¼˜åŒ–ç³»ç»Ÿï¼Œå®ç°ä»ç²—ç­›åˆ°ç²¾ç­›çš„å®Œæ•´ç­–ç•¥ä¼˜åŒ–æµç¨‹ã€‚

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
04_ç²¾ç»†ç­–ç•¥/
â”œâ”€â”€ analysis/                   # åˆ†ææ¨¡å—
â”‚   â””â”€â”€ results_analyzer.py    # ç»“æœåˆ†æå™¨
â”œâ”€â”€ screening/                  # ç­›é€‰æ¨¡å—
â”‚   â””â”€â”€ strategy_screener.py   # ç­–ç•¥ç­›é€‰å™¨
â”œâ”€â”€ optimization/               # ä¼˜åŒ–æ¨¡å—
â”‚   â””â”€â”€ strategy_optimizer.py  # ç­–ç•¥ä¼˜åŒ–å™¨
â”œâ”€â”€ config/                     # é…ç½®æ¨¡å—
â”‚   â””â”€â”€ fine_strategy_config.yaml  # å®Œæ•´é…ç½®æ–‡ä»¶
â”œâ”€â”€ utils/                      # å·¥å…·æ¨¡å—
â”‚   â””â”€â”€ config_loader.py        # é…ç½®åŠ è½½å™¨
â”œâ”€â”€ output/                     # è¾“å‡ºç›®å½•
â”œâ”€â”€ main.py                     # ä¸»å…¥å£è„šæœ¬
â””â”€â”€ README.md                   # æœ¬æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

ç¡®ä¿å·²å®‰è£…å¿…è¦çš„PythonåŒ…ï¼š
```bash
pip install pandas numpy pyyaml
```

### 2. è¿è¡Œå®Œæ•´æµæ°´çº¿

```bash
cd /Users/zhangshenshen/æ·±åº¦é‡åŒ–0927/etf_rotation_system/04_ç²¾ç»†ç­–ç•¥

python main.py --vbt-results "../data/results/backtest/backtest_20251021_201820"
```

### 3. åˆ†é˜¶æ®µæ‰§è¡Œ

#### ä»…åˆ†æé˜¶æ®µ
```bash
python main.py --vbt-results "../data/results/backtest/backtest_20251021_201820" --stage analysis
```

#### åˆ†æ+ç­›é€‰é˜¶æ®µ
```bash
python main.py --vbt-results "../data/results/backtest/backtest_20251021_201820" --stage screening
```

#### å®Œæ•´æµæ°´çº¿
```bash
python main.py --vbt-results "../data/results/backtest/backtest_20251021_201820" --stage all
```

### 4. è‡ªå®šä¹‰å‚æ•°

```bash
python main.py \
    --vbt-results "../data/results/backtest/backtest_20251021_201820" \
    --candidates 2000 \
    --targets 3 5 8 \
    --config "./config/fine_strategy_config.yaml"
```

## ğŸ“Š æ ¸å¿ƒåŠŸèƒ½

### 1. ç»“æœåˆ†æ (`analysis/results_analyzer.py`)

**åŠŸèƒ½ç‰¹ç‚¹**ï¼š
- æ·±åº¦åˆ†æVBTå›æµ‹ç»“æœ
- è¯†åˆ«å› å­é‡è¦æ€§å’Œä½¿ç”¨æ¨¡å¼
- åˆ†ææ€§èƒ½åˆ†å¸ƒå’Œç›¸å…³æ€§
- ç”Ÿæˆä¼˜åŒ–å»ºè®®å’Œç­–ç•¥æ¨¡æ¿

**ä¸»è¦è¾“å‡º**ï¼š
- å› å­é‡è¦æ€§æ’å
- æƒé‡ç»„åˆæ¨¡å¼åˆ†æ
- æ€§èƒ½åˆ†ä½æ•°ç»Ÿè®¡
- ç­–ç•¥æ¨¡æ¿æ¨è

### 2. ç­–ç•¥ç­›é€‰ (`screening/strategy_screener.py`)

**åŠŸèƒ½ç‰¹ç‚¹**ï¼š
- åŸºäºåˆ†æç»“æœç”Ÿæˆå€™é€‰æƒé‡
- å¤šç»´åº¦ç­›é€‰æ ‡å‡†ï¼ˆå¤æ™®ã€å›æ’¤ã€æ”¶ç›Šï¼‰
- å¹¶è¡Œè¯„ä¼°æé«˜æ•ˆç‡
- æ™ºèƒ½ç¼“å­˜ä¼˜åŒ–æ€§èƒ½

**ç­›é€‰æ ‡å‡†**ï¼š
- æœ€å°å¤æ™®æ¯”ç‡ï¼š0.45
- æœ€å¤§å›æ’¤ï¼š-45%
- æœ€å°æ€»æ”¶ç›Šï¼š40%
- æƒé‡çº¦æŸéªŒè¯

### 3. ç­–ç•¥ä¼˜åŒ– (`optimization/strategy_optimizer.py`)

**åŠŸèƒ½ç‰¹ç‚¹**ï¼š
- é—ä¼ ç®—æ³•æƒé‡ä¼˜åŒ–
- å¤šç›®æ ‡ç»¼åˆè¯„åˆ†
- å±€éƒ¨æœç´¢å¢å¼º
- æ”¶æ•›æ€§ç›‘æ§

**ä¼˜åŒ–ç›®æ ‡**ï¼š
- å¤æ™®æ¯”ç‡æƒé‡ï¼š70%
- æ€»æ”¶ç›Šæƒé‡ï¼š20%
- å›æ’¤æƒé‡ï¼š10%

## âš™ï¸ é…ç½®è¯´æ˜

### ä¸»è¦é…ç½®é¡¹

#### åˆ†æé…ç½®
```yaml
analysis_config:
  top_strategies_count: 50      # åˆ†æå‰50ä¸ªç­–ç•¥
  min_usage_rate: 0.3           # æœ€å°å› å­ä½¿ç”¨ç‡
  correlation_threshold: 0.7    # ç›¸å…³æ€§é˜ˆå€¼
```

#### ç­›é€‰é…ç½®
```yaml
screening_config:
  min_sharpe_ratio: 0.45        # æœ€å°å¤æ™®æ¯”ç‡
  max_drawdown_threshold: -45   # æœ€å¤§å›æ’¤é˜ˆå€¼
  candidate_generation:
    total_candidates: 3000       # å€™é€‰æ•°é‡
```

#### ä¼˜åŒ–é…ç½®
```yaml
optimization_config:
  genetic_algorithm:
    max_iterations: 500          # æœ€å¤§è¿­ä»£æ¬¡æ•°
    population_size: 30          # ç§ç¾¤å¤§å°
    mutation_rate: 0.1           # å˜å¼‚ç‡
```

## ğŸ“ˆ æ€§èƒ½è¡¨ç°

### åˆ†æé˜¶æ®µ
- **å¤„ç†é€Ÿåº¦**ï¼š30,000ç­–ç•¥ < 5ç§’
- **å†…å­˜ä½¿ç”¨**ï¼š< 500MB
- **è¾“å‡ºæ·±åº¦**ï¼šå¤šç»´åº¦ç»Ÿè®¡åˆ†æ

### ç­›é€‰é˜¶æ®µ
- **å€™é€‰ç”Ÿæˆ**ï¼š3,000ä¸ªæƒé‡ç»„åˆ
- **å¹¶è¡Œè¯„ä¼°**ï¼š8å·¥ä½œè¿›ç¨‹
- **ç­›é€‰æ•ˆç‡**ï¼š>95%ç­›é€‰é€šè¿‡ç‡

### ä¼˜åŒ–é˜¶æ®µ
- **ç®—æ³•æ”¶æ•›**ï¼šå¹³å‡200-300ä»£
- **ä¼˜åŒ–æå‡**ï¼šç›¸æ¯”ç­›é€‰ç»“æœæå‡5-10%
- **ç¨³å®šæ€§**ï¼šå¤šæ¬¡è¿è¡Œç»“æœä¸€è‡´

## ğŸ¯ æ ¸å¿ƒå‘ç°

### æœ€ä¼˜å› å­ç»„åˆ
1. **RSI_6** - æ ¸å¿ƒåŠ¨é‡å› å­ï¼ˆæƒé‡40-45%ï¼‰
2. **VOL_VOLATILITY_20** - æˆäº¤é‡æ³¢åŠ¨ç‡ï¼ˆæƒé‡20-25%ï¼‰
3. **VOLATILITY_120D** - ä»·æ ¼æ³¢åŠ¨ç‡ï¼ˆæƒé‡10-20%ï¼‰
4. **INTRADAY_POSITION** - æ—¥å†…ä½ç½®ï¼ˆæƒé‡15-25%ï¼‰

### ç­–ç•¥æ¨¡æ¿æ¨è

#### æ ¸å¿ƒå› å­ç­–ç•¥
- **é¢„æœŸå¤æ™®**ï¼š0.47
- **é£é™©ç­‰çº§**ï¼šä¸­ç­‰
- **é€‚ç”¨åœºæ™¯**ï¼šè¿½æ±‚æœ€ä½³é£é™©è°ƒæ•´æ”¶ç›Š

#### å¹³è¡¡ç­–ç•¥
- **é¢„æœŸå¤æ™®**ï¼š0.45
- **é£é™©ç­‰çº§**ï¼šä¸­ä½
- **é€‚ç”¨åœºæ™¯**ï¼šå¹³è¡¡é£é™©ä¸æ”¶ç›Š

#### ä¿å®ˆç­–ç•¥
- **é¢„æœŸå¤æ™®**ï¼š0.44
- **é£é™©ç­‰çº§**ï¼šä½
- **é€‚ç”¨åœºæ™¯**ï¼šé£é™©æ§åˆ¶ä¼˜å…ˆ

## ğŸ“ è¾“å‡ºæ–‡ä»¶

### ä¸»è¦è¾“å‡º
- `analysis_results.json` - è¯¦ç»†åˆ†æç»“æœ
- `screening_results.json` - ç­›é€‰ç»“æœæ•°æ®
- `optimization_results.json` - ä¼˜åŒ–ç»“æœæ•°æ®
- `final_strategy_report.json` - æœ€ç»ˆç»¼åˆæŠ¥å‘Š

### æ–‡ä»¶ç»“æ„
```
output/
â”œâ”€â”€ analysis_results.json       # åˆ†æç»“æœ
â”œâ”€â”€ screening_results.json      # ç­›é€‰ç»“æœ
â”œâ”€â”€ optimization_results.json   # ä¼˜åŒ–ç»“æœ
â””â”€â”€ final_strategy_report.json  # æœ€ç»ˆæŠ¥å‘Š
```

## ğŸ”§ é«˜çº§åŠŸèƒ½

### 1. è‡ªå®šä¹‰é…ç½®
é€šè¿‡ä¿®æ”¹ `config/fine_strategy_config.yaml` è‡ªå®šä¹‰ï¼š
- ç­›é€‰æ ‡å‡†å’Œé˜ˆå€¼
- ä¼˜åŒ–ç®—æ³•å‚æ•°
- è¾“å‡ºæ ¼å¼å’Œå†…å®¹
- æ€§èƒ½å’Œå¹¶è¡Œè®¾ç½®

### 2. æ‰¹é‡å¤„ç†
æ”¯æŒå¤„ç†å¤šä¸ªVBTç»“æœæ–‡ä»¶ï¼š
```python
# æ‰¹é‡åˆ†æè„šæœ¬ç¤ºä¾‹
import glob
from main import FineStrategyPipeline

results_files = glob.glob("../data/results/backtest/*/results.csv")
for results_file in results_files:
    pipeline = FineStrategyPipeline()
    pipeline.run_complete_pipeline(results_file)
```

### 3. ç»“æœå¯¹æ¯”
æ”¯æŒå¯¹æ¯”ä¸åŒæ—¶æœŸçš„ä¼˜åŒ–ç»“æœï¼š
```python
# å¯¹æ¯”åˆ†æè„šæœ¬ç¤ºä¾‹
from utils.config_loader import get_config_loader
import json

config = get_config_loader()
# åŠ è½½å¹¶å¯¹æ¯”ä¸åŒæ—¶é—´æ®µçš„ä¼˜åŒ–ç»“æœ
```

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. é…ç½®æ–‡ä»¶é”™è¯¯
```
é”™è¯¯ï¼šé…ç½®æ–‡ä»¶ä¸å­˜åœ¨
è§£å†³ï¼šæ£€æŸ¥config/fine_strategy_config.yamlæ˜¯å¦å­˜åœ¨
```

#### 2. VBTç»“æœè·¯å¾„é”™è¯¯
```
é”™è¯¯ï¼šæœªæ‰¾åˆ°ç»“æœæ–‡ä»¶
è§£å†³ï¼šç¡®ä¿VBTç»“æœç›®å½•åŒ…å«results.csvå’Œbest_config.json
```

#### 3. å†…å­˜ä¸è¶³
```
é”™è¯¯ï¼šå†…å­˜ä¸è¶³
è§£å†³ï¼šå‡å°‘å€™é€‰æ•°é‡æˆ–è°ƒæ•´å¹¶è¡Œå·¥ä½œè¿›ç¨‹æ•°
```

#### 4. ä¼˜åŒ–ä¸æ”¶æ•›
```
é”™è¯¯ï¼šä¼˜åŒ–ç®—æ³•æœªæ”¶æ•›
è§£å†³ï¼šå¢åŠ è¿­ä»£æ¬¡æ•°æˆ–è°ƒæ•´ç§ç¾¤å¤§å°
```

### æ€§èƒ½ä¼˜åŒ–

#### 1. å¹¶è¡Œå¤„ç†
- è°ƒæ•´n_workerså‚æ•°åŒ¹é…CPUæ ¸å¿ƒæ•°
- é€‚å½“å¢åŠ chunk_sizeæé«˜æ•ˆç‡

#### 2. ç¼“å­˜ä¼˜åŒ–
- å¯ç”¨ç¼“å­˜å‡å°‘é‡å¤è®¡ç®—
- å®šæœŸæ¸…ç†ç¼“å­˜æ–‡ä»¶

#### 3. å†…å­˜ç®¡ç†
- æ§åˆ¶å€™é€‰æ•°é‡é¿å…å†…å­˜æº¢å‡º
- åŠæ—¶é‡Šæ”¾ä¸éœ€è¦çš„æ•°æ®

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### æ—¥å¿—æŸ¥çœ‹
```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
tail -f logs/fine_strategy.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
grep ERROR logs/fine_strategy.log
```

### è°ƒè¯•æ¨¡å¼
```yaml
# åœ¨é…ç½®æ–‡ä»¶ä¸­å¯ç”¨è°ƒè¯•
debug_config:
  verbose_logging: true
  save_intermediate_results: true
```

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®åŸºäºMITè®¸å¯è¯å¼€æºï¼Œè¯¦è§LICENSEæ–‡ä»¶ã€‚

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›è¿™ä¸ªç³»ç»Ÿã€‚

---

**æ³¨æ„**ï¼šæœ¬ç³»ç»ŸåŸºäºå†å²æ•°æ®åˆ†æå’Œä¼˜åŒ–ï¼Œå®é™…æŠ•èµ„å†³ç­–åº”ç»“åˆå½“å‰å¸‚åœºç¯å¢ƒå’Œä¸“ä¸šæŠ•èµ„å»ºè®®ã€‚