
⏺ 问题分析与修复要求

  🎯 核心问题点

  1. 数据层混淆
  - 系统从factor_ready层读取因子时间序列数据（错误）
  - factor_ready层存储的是因子评估结果（50个因子的5维度评分）
  - 因子时间序列数据实际存储在factor_output层

  2. 架构违背
  - 违背了你的三层分离设计原则
  - 混淆了"因子筛选层"和"因子输出层"的职责
  - 导致系统降级运行（多因子融合→传统反转逻辑）

  🔧 约束条件

  1. 架构约束
  - 严格遵守三层分离架构
  - factor_ready层：仅用于因子评估和筛选
  - factor_output层：存储因子时间序列数据
  - 运行时桥接：正确使用各层数据

  2. 数据约束
  - factor_ready/0700_HK_best_factors.parquet：50个因子评分数据
  - factor_output/{timeframe}/：实际的因子时间序列数据
  - 保持现有的数据格式和存储结构

  3. 功能约束
  - 不修改数据源文件
  - 保持50个因子的完整性
  - 确保多因子融合算法正常工作
  - 消除rank列缺失警告（通过正确数据源）

  ✅ 必须交付的要求

  1. 正确的数据流
  # 因子评分：从factor_ready层加载
  factor_scores = load_factor_scores("0700.HK")  # 50个因子评估

  # 时间序列：从factor_output层加载  
  factor_time_series = load_factor_time_series("0700.HK", "5min")  # 实际因子值

  2. 完整的多因子融合
  - 使用50个因子的时间序列数据
  - 正确的因子权重计算
  - 消除rank列缺失错误
  - 系统运行在多因子模式（非降级模式）

  3. 架构一致性
  - 遵循你的ARCHITECTURE.md设计
  - 各层职责清晰分离
  - 数据流符合三层架构原则

  4. 日志验证
  - 成功加载50个因子时间序列
  - 多因子融合正常工作
  - 无警告和降级运行日志

  📝 具体修复任务

  修改 factor_interface.py：

  1. 添加factor_output层支持
    - 新增方法读取factor_output目录的时间序列数据
    - 保持现有factor_ready层读取因子评分的功能
  2. 修正数据加载逻辑
    - 因子评分：从factor_ready加载
    - 时间序列：从factor_output加载
    - 确保数据格式匹配系统期望
  3. 保持向后兼容
    - 不破坏现有接口
    - 维持配置文件结构
    - 保留错误处理机制

  预期结果：
  - 系统从正确的数据层读取正确类型的数据
  - 50个因子的时间序列数据被正确加载和使用
  - 多因子融合算法完全正常工作
  - 符合你的三层分离架构设计理念