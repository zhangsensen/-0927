# =============================================================================
# 排序模式配置 (生产推荐: ML 排序)
# =============================================================================
# 控制 WFO 后如何选择最终的 TopN 组合
#
# method: "ml" (推荐) 或 "wfo" (备用)
#   - "ml":  ✅ 推荐 - 使用已训练的 ML 排序模型
#            A/B 测试验证: Top-200 平均 Sharpe +69%, 年化收益 +7.87%
#            适用于生产环境, 具备良好的泛化能力和风险控制
#
#   - "wfo": ⚠️ 备用 - 使用原始 WFO 指标排序 (mean_oos_ic, oos_sharpe_proxy 等)
#            用于对照基准或 ML 模型不可用时的回退选项
#
# top_n: 最终选出的组合数量 (用于后续回测)
# ml_model_path: ML 模型路径 (无扩展名, 仅当 method="ml" 时使用)
#
# 注意:
#   - ML 模式依赖 ml_ranker/models/ltr_ranker 模型文件
#   - 若 ML 模型缺失或加载失败, 系统会自动回退到 WFO 排序
#   - 如需使用原始 WFO 排序, 只需将 method 改为 "wfo"
#   - 定期 (每季度) 重训模型以适应市场变化: python run_ranking_pipeline.py
# =============================================================================
ranking:
  method: "ml"  # 生产默认: "ml" (ML模型排序) | 备用: "wfo" (原始WFO排序)
  top_n: 2000   # 最终选择的组合数量
  ml_model_path: "ml_ranker/models/ltr_ranker"  # ML模型路径 (无扩展名)

backtest:
  commission_rate: 0.000005  # 万0.5（真实ETF场内交易费率）
  initial_capital: 1000000
  lookback_window: 252
  rebalance_frequency: 21d
  max_workers: 8
  
  # 网格搜索配置
  # 固化调仓频率：已验证 8 天最优，关闭全频率扫描避免无意义耗时
  test_all_frequencies: false
  test_all_position_sizes: false  # 已验证最优值为4，无需再扫描
  position_size_range: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
combo_wfo:
  combo_sizes:
  - 2
  - 3
  - 4
  - 5
  enable_fdr: true
  fdr_alpha: 0.05
  fdr_method: fdr_bh
  is_period: 252
  n_jobs: -1
  oos_period: 60
  rebalance_frequencies:
  - 8
  save_all_results: true
  scoring:
    complexity_penalty_lambda: 0.15
    use_robust_scoring: true
  scoring_strategy: ic
  step_size: 60
  top_n: 5000
  verbose: true
cross_section:
  bounded_factors:
  - PRICE_POSITION_20D
  - PRICE_POSITION_120D
  - PV_CORR_20D
  - RSI_14
  winsorize_lower: 0.025
  winsorize_upper: 0.975
data:
  cache_dir: null
  data_dir: null
  end_date: '2025-10-14'
  start_date: '2020-01-01'
  symbols:
  - '159801'
  - '159819'
  - '159859'
  - '159883'
  - '159915'
  - '159920'
  - '159928'
  - '159949'
  - '159992'
  - '159995'
  - '159998'
  - '510050'
  - '510300'
  - '510500'
  - '511010'
  - '511260'
  - '511380'
  - '512010'
  - '512100'
  - '512400'
  - '512480'
  - '512660'
  - '512690'
  - '512720'
  - '512800'
  - '512880'
  - '512980'
  - '513050'
  - '513100'
  - '513130'
  - '513500'
  - '515030'
  - '515180'
  - '515210'
  - '515650'
  - '515790'
  - '516090'
  - '516160'
  - '516520'
  - '518850'
  - '518880'
  - '588000'
  - '588200'
output_root: results_combo_wfo
run_id: COMBO_WFO_DEEP_MINING
