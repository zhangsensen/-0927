# 最优解配置：预测能力核心化公平评分算法
# 设计目标：消除低频偏差，突出真正有预测能力的因子
# 核心原则：预测能力至上，时间框架公平，硬性质量门槛

# 公平评分器配置 - 完全重构版
fair_scorer:
  # 启用预测能力核心化评分
  enabled: true
  mode: "predictive_power_centric"  # 新模式：预测能力核心化

  # 统计功效归一化参数
  reference_sample_size: 1000
  min_reliable_sample: 200

  # 🎯 时间框架公平配置：完全移除偏差奖励
  timeframe_adjustments:
    # 所有时间框架采用统一标准，无特殊奖励
    1min:
      stability_bonus: 0.0          # 移除所有稳定性奖励
      uncertainty_penalty: 1.0      # 无惩罚
      economic_significance_discount: 1.0  # 无折扣
      predictive_power_boost: 0.0   # 无特殊提升

    2min:
      stability_bonus: 0.0
      uncertainty_penalty: 1.0
      economic_significance_discount: 1.0
      predictive_power_boost: 0.0

    3min:
      stability_bonus: 0.0
      uncertainty_penalty: 1.0
      economic_significance_discount: 1.0
      predictive_power_boost: 0.0

    5min:
      stability_bonus: 0.0
      uncertainty_penalty: 1.0
      economic_significance_discount: 1.0
      predictive_power_boost: 0.0

    15min:
      stability_bonus: 0.0
      uncertainty_penalty: 1.0
      economic_significance_discount: 1.0
      predictive_power_boost: 0.0

    30min:
      stability_bonus: 0.0
      uncertainty_penalty: 1.0
      economic_significance_discount: 1.0
      predictive_power_boost: 0.0

    60min:
      stability_bonus: 0.0
      uncertainty_penalty: 1.0
      economic_significance_discount: 1.0
      predictive_power_boost: 0.0

    2h:
      stability_bonus: 0.0          # 移除原来的8%奖励
      uncertainty_penalty: 1.0      # 移除原来的0.8惩罚
      economic_significance_discount: 1.0  # 移除原来的1.1奖励
      predictive_power_boost: 0.0

    4h:
      stability_bonus: 0.0          # 移除原来的10%奖励
      uncertainty_penalty: 1.0      # 移除原来的0.75惩罚
      economic_significance_discount: 1.0  # 移除原来的1.15奖励
      predictive_power_boost: 0.0

    1day:
      stability_bonus: 0.0          # 移除原来的25%奖励
      uncertainty_penalty: 1.0      # 移除原来的0.85惩罚
      economic_significance_discount: 1.0  # 移除原来的1.3奖励
      predictive_power_boost: 0.0

# 🎯 样本量权重配置：温和调整，避免过度偏差
sample_weight_params:
  enable: true
  min_full_weight_samples: 500      # 提高门槛，减少样本量影响
  weight_power: 0.2                 # 大幅降低折扣系数
  predictive_weight_power: 0.1     # 预测能力维度几乎不受样本量影响

  # 受影响的维度（预测能力影响最小）
  affected_dimensions:
    - stability
    - independence
    - practicality
    - short_term_fitness

  # 维度特殊权重
  dimension_weights:
    stability: 0.9          # 稳定性对样本量相对不敏感
    independence: 0.8       # 独立性需要适度样本
    practicality: 0.95      # 实用性对样本量最不敏感
    short_term_fitness: 0.9 # 适应性对样本量相对不敏感

# 🎯 综合评分权重：预测能力核心化
timeframe_weights:
  # 统一权重配置：所有时间框架相同标准
  default:
    predictive_power: 0.60      # 🎯 核心维度：预测能力占60%
    stability: 0.15              # 辅助维度：稳定性占15%
    independence: 0.15           # 辅助维度：独立性占15%
    practicality: 0.07           # 次要维度：实用性占7%
    short_term_fitness: 0.03     # 次要维度：短期适应性占3%

  # 为兼容性保留，但所有时间框架使用相同权重
  1min:    {predictive_power: 0.60, stability: 0.15, independence: 0.15, practicality: 0.07, short_term_fitness: 0.03}
  2min:    {predictive_power: 0.60, stability: 0.15, independence: 0.15, practicality: 0.07, short_term_fitness: 0.03}
  3min:    {predictive_power: 0.60, stability: 0.15, independence: 0.15, practicality: 0.07, short_term_fitness: 0.03}
  5min:    {predictive_power: 0.60, stability: 0.15, independence: 0.15, practicality: 0.07, short_term_fitness: 0.03}
  15min:   {predictive_power: 0.60, stability: 0.15, independence: 0.15, practicality: 0.07, short_term_fitness: 0.03}
  30min:   {predictive_power: 0.60, stability: 0.15, independence: 0.15, practicality: 0.07, short_term_fitness: 0.03}
  60min:   {predictive_power: 0.60, stability: 0.15, independence: 0.15, practicality: 0.07, short_term_fitness: 0.03}
  2h:      {predictive_power: 0.60, stability: 0.15, independence: 0.15, practicality: 0.07, short_term_fitness: 0.03}
  4h:      {predictive_power: 0.60, stability: 0.15, independence: 0.15, practicality: 0.07, short_term_fitness: 0.03}
  1day:    {predictive_power: 0.60, stability: 0.15, independence: 0.15, practicality: 0.07, short_term_fitness: 0.03}

# 🎯 筛选阈值配置：统一严格标准
screening_thresholds:
  # 统一阈值：所有时间框架相同标准
  default:
    min_ic_threshold: 0.025        # 提高IC门槛：确保基本预测能力
    min_ir_threshold: 0.40         # 提高IR门槛：确保风险调整后收益
    min_robustness_score: 0.65     # 提高稳健性门槛
    min_predictive_power: 0.30     # 🎯 新增：预测能力硬性门槛
    max_turnover_threshold: 0.40   # 新增：换手率上限

  # 为兼容性保留，但使用相同标准
  1min:    {min_ic_threshold: 0.025, min_ir_threshold: 0.40, min_robustness_score: 0.65, min_predictive_power: 0.30, max_turnover_threshold: 0.40}
  2min:    {min_ic_threshold: 0.025, min_ir_threshold: 0.40, min_robustness_score: 0.65, min_predictive_power: 0.30, max_turnover_threshold: 0.40}
  3min:    {min_ic_threshold: 0.025, min_ir_threshold: 0.40, min_robustness_score: 0.65, min_predictive_power: 0.30, max_turnover_threshold: 0.40}
  5min:    {min_ic_threshold: 0.025, min_ir_threshold: 0.40, min_robustness_score: 0.65, min_predictive_power: 0.30, max_turnover_threshold: 0.40}
  15min:   {min_ic_threshold: 0.025, min_ir_threshold: 0.40, min_robustness_score: 0.65, min_predictive_power: 0.30, max_turnover_threshold: 0.40}
  30min:   {min_ic_threshold: 0.025, min_ir_threshold: 0.40, min_robustness_score: 0.65, min_predictive_power: 0.30, max_turnover_threshold: 0.40}
  60min:   {min_ic_threshold: 0.025, min_ir_threshold: 0.40, min_robustness_score: 0.65, min_predictive_power: 0.30, max_turnover_threshold: 0.40}
  2h:      {min_ic_threshold: 0.025, min_ir_threshold: 0.40, min_robustness_score: 0.65, min_predictive_power: 0.30, max_turnover_threshold: 0.40}
  4h:      {min_ic_threshold: 0.025, min_ir_threshold: 0.40, min_robustness_score: 0.65, min_predictive_power: 0.30, max_turnover_threshold: 0.40}
  1day:    {min_ic_threshold: 0.025, min_ir_threshold: 0.40, min_robustness_score: 0.65, min_predictive_power: 0.30, max_turnover_threshold: 0.40}

# 🎯 Tier阈值：样本量自适应分层（修复中等时间框架消失问题）
tier_thresholds:
  # 样本量自适应阈值：补偿样本量不足的劣势
  default:
    tier1: 0.80        # 优秀因子：预测能力突出
    tier2: 0.65        # 良好因子：预测能力良好
    tier3: 0.50        # 及格因子：基本预测能力
    upgrade_tier2: 0.62
    upgrade_tier1: 0.77

  # 🔧 样本量自适应调整：根据实际数据特征动态调整
  1min:    {tier1: 0.80, tier2: 0.70, tier3: 0.55, upgrade_tier2: 0.65, upgrade_tier1: 0.77}  # 样本充足，保持高标准
  2min:    {tier1: 0.78, tier2: 0.62, tier3: 0.48, upgrade_tier2: 0.58, upgrade_tier1: 0.75}  # 样本减半，适度降低
  3min:    {tier1: 0.77, tier2: 0.60, tier3: 0.46, upgrade_tier2: 0.56, upgrade_tier1: 0.73}  # 继续降低
  5min:    {tier1: 0.75, tier2: 0.58, tier3: 0.44, upgrade_tier2: 0.54, upgrade_tier1: 0.71}  # 中等样本
  15min:   {tier1: 0.72, tier2: 0.55, tier3: 0.42, upgrade_tier2: 0.51, upgrade_tier1: 0.68}  # 样本较少
  30min:   {tier1: 0.70, tier2: 0.52, tier3: 0.40, upgrade_tier2: 0.48, upgrade_tier1: 0.65}  # 保持原阈值
  60min:   {tier1: 0.68, tier2: 0.50, tier3: 0.38, upgrade_tier2: 0.45, upgrade_tier1: 0.62}  # 继续调整
  2h:      {tier1: 0.66, tier2: 0.48, tier3: 0.36, upgrade_tier2: 0.43, upgrade_tier1: 0.60}  # 低频保持合理
  4h:      {tier1: 0.65, tier2: 0.47, tier3: 0.35, upgrade_tier2: 0.42, upgrade_tier1: 0.58}
  1day:    {tier1: 0.64, tier2: 0.46, tier3: 0.34, upgrade_tier2: 0.41, upgrade_tier1: 0.57}  # 日线最低

# 调试和监控配置
debug:
  enable_fair_scoring_log: true
  show_detailed_breakdown: true
  compare_original_vs_fair: true

  # 新增：预测能力核心化监控
  predictive_power_monitoring:
    track_predictive_distribution: true
    highlight_low_predictive_high_score: true  # 高亮低预测能力高评分的异常因子
    log_predictive_threshold_violations: true   # 记录预测能力门槛违规
    show_timeframe_predictive_comparison: true  # 显示时间框架预测能力对比

  generate_comparison_report: true
  comparison_metrics:
    - predictive_power_distribution_by_timeframe
    - stability_vs_predictive_power_scatter
    - top_factors_predictive_power_analysis
    - time_framework_bias_detection
    - predictive_threshold_impact_analysis