# ETF Rotation Strategy Project - Overview & Quick Start

> **For AI Agents & New Developers**: This document serves as the primary entry point to understand the project structure, recent changes, and how to operate the backtesting system.

## 1. Project Purpose
This project implements a **Walk-Forward Optimization (WFO)** based ETF rotation strategy for the Hong Kong market (or similar). It aims to identify robust factor combinations that outperform the market by dynamically selecting ETFs based on technical indicators.

**Key Features:**
- **Universe**: 43 ETFs (Hong Kong / Cross-border).
- **Factors**: 18 Technical Indicators (RSI, MOM, VOL, etc.).
- **Methodology**: Walk-Forward Optimization (WFO) to avoid overfitting.
- **Execution**: Vectorized backtesting with strict **No-Lookahead Bias**.
- **Cost Model**: Realistic Hong Kong transaction costs (Commission 0.2%, Stamp Duty 0.1%, Slippage).

## 2. Recent Major Changes (Refactor 2025-11)
We have transitioned from a script-heavy experimental codebase to a modular, production-grade system following **Linus Torvalds' engineering principles** (No magic, just math and code).

### Key Improvements:
1.  **Unified Backtest Engine**: `etf_rotation_experiments/strategies/backtest/production_backtest.py`
    -   Replaces multiple ad-hoc scripts.
    -   Enforces strict data contracts (UTC timestamps, aligned indices).
    -   Supports "Profit-First" logic with realistic slippage grids.
2.  **Core Modules**:
    -   `core/data_loader.py`: Centralized data loading with caching.
    -   `core/precise_factor_library_v2.py`: Numba-accelerated factor calculations.
    -   `core/cross_section_processor.py`: Standardized cross-sectional ranking and scoring.
3.  **Full Universe Validation**:
    -   Successfully ran WFO on **12,597** factor combinations.
    -   Identified **1,370** strategies meeting strict deployable criteria (Sharpe > 1.0, MaxDD > -25%).

## 3. Key Results (As of 2025-11-25)
Full backtest on 12,597 combinations completed.

-   **Top Strategy**: `MAX_DD_60D + RSI_14 + SLOPE_20D + VOL_RATIO_60D + VORTEX_14D`
    -   **Sharpe**: 1.25
    -   **Annual Return**: 24.7%
    -   **Max Drawdown**: -21.5%
-   **Overall Stats**:
    -   Average Sharpe: 0.63
    -   Positive Expectancy Strategies: > 10% of universe.

ðŸ‘‰ **See [DEPLOYABLE_STRATEGIES.md](DEPLOYABLE_STRATEGIES.md) for the top 20 candidates.**

## 4. Quick Start Guide

### Prerequisites
- Python 3.12+
- Virtual Environment (`.venv`)

### Environment Setup
```bash
source .venv/bin/activate
export PYTHONPATH=$PYTHONPATH:$(pwd)/etf_rotation_experiments
export RB_CONFIG_FILE=$(pwd)/etf_rotation_experiments/configs/combo_wfo_config.yaml
```

### How to Run Backtest
To run the production backtest on all strategies:

```bash
# Ensure you are in the project root
cd /home/sensen/dev/projects/-0927

# Run the backtest (use nohup for long runs)
RB_BACKTEST_ALL=1 nohup python etf_rotation_experiments/strategies/backtest/production_backtest.py > backtest.log 2>&1 &
```

### How to Analyze Results
Results are saved in `etf_rotation_experiments/results_combo_wfo/<timestamp>/`.
The main summary file is `top12597_backtest_by_ic_..._full.csv`.

You can use pandas to filter results:
```python
import pandas as pd
df = pd.read_csv('path/to/result.csv')
best = df[df['sharpe'] > 1.0]
print(best)
```

## 5. Directory Structure
```
etf_rotation_experiments/
â”œâ”€â”€ configs/              # Configuration files (YAML)
â”œâ”€â”€ core/                 # Core libraries (Data, Factors, Math)
â”œâ”€â”€ strategies/
â”‚   â””â”€â”€ backtest/         # Backtest engines (production_backtest.py)
â”œâ”€â”€ results_combo_wfo/    # Output directory for WFO results
â”œâ”€â”€ data/                 # Raw and processed data
â””â”€â”€ ...
```

## 6. Next Steps for AI Agents
1.  **Refinement**: Analyze the `DEPLOYABLE_STRATEGIES.md` and select a subset for portfolio construction.
2.  **Optimization**: Explore parameter tuning for the top 5 strategies.
3.  **Live Trading**: Connect the selected strategy signals to the execution engine (not covered in this repo yet).

---
*Generated by GitHub Copilot (Gemini 3 Pro) - 2025-11-25*
