# v3.1 高频轮动策略 实盘执行与风控规则说明

> 适用对象：43 ETF 高频轮动 v3.1 主策略（WFO + VEC + BT 已完成三重验证）
> 目标：在保证长期收益曲线不被破坏的前提下，安全、可控地上线小资金实盘，并通过量化监控决定何时加仓 / 减仓。

---

## 1. 实盘定位与资金规划

- 策略角色：
  - 明确定位为 **“进攻型轮动引擎”**，负责在趋势和结构性机会出现时获取主要超额收益；
  - 不承担“全天候防御”职责（债券/黄金只是候选之一，而非强制配置）。
- 初始资金建议：
  - 第一期试运行：**5 万** 资金（或你计划目标仓位的 10%–20%），用于验证执行细节与心理接受度；
  - 后续加仓以“窗口指标 + 行为检查”为前提，禁止一次性放大到目标满仓。
- 单策略 vs 多策略：
  - 当前 v3.1 主策略可以视作“策略簇”中的一条主线；
  - 未来若新增“防御策略线”（如显式债/金切换），应在资金层面与本策略分账户或分子组合管理。

---

## 2. 日常运行流程

### 2.1 每日操作（收盘后）

1. 运行生产择股 / 调仓脚本（例如）：
   - `uv run python src/etf_strategy/run_combo_wfo.py`（如需重新评分）
   - 或使用已固化的 Top 策略列表直接生成当日持仓信号。
2. 根据策略信号，在券商端下单：
   - 调仓频率为 **每 3 个交易日**，中间日不下新单；
   - 优先使用限价单，避免极端盘口滑点。
3. 记录执行日志：
   - 每日导出当日成交记录（券商侧）与模型侧目标持仓，留档对账。

### 2.2 每周 / 每月监控

1. 跑近期窗口 BT 审计（Top 策略健康度）：
   - 命令：
     - `uv run python scripts/recent_bt_audit.py --topn 5 --windows 60 120 240`
   - 关键输出：
     - 汇总表：[results/recent_bt_audit/recent_bt_summary_top5_windows_60-120-240d.csv](results/recent_bt_audit/recent_bt_summary_top5_windows_60-120-240d.csv)
     - 多窗口总览图：[results/recent_bt_audit/recent_bt_windows_60-120-240d.png](results/recent_bt_audit/recent_bt_windows_60-120-240d.png)
2. 查看三档时间窗口表现：
   - 60 天：最近两三个月，短期状态；
   - 120 天：最近一季到半年，中期状态；
   - 240 天：近一年的整体贡献，长期状态。

---

## 3. 多窗口指标定义

在 recent_bt_audit 汇总表中，每个策略（按最终排名 Rank 排序）包含：

- 全周期 BT 指标：
  - `bt_return`：全历史总收益率；
  - `bt_max_drawdown`：全历史最大回撤；
  - `bt_annual_return`：年化收益；
  - `bt_sharpe_ratio`：年化 Sharpe；
  - `bt_calmar_ratio`：Calmar 比率。
- 多个窗口的近期指标（以 60 天为例）：
  - `window60_start` / `window60_end`：窗口起止日期；
  - `window60_return`：窗口内总收益率；
  - `window60_max_drawdown`：窗口内最大回撤；
  - `window60_sharpe`：以日度收益粗略估算的年化 Sharpe。
- 同理，`window120_*`、`window240_*` 表示 120 / 240 天窗口对应字段。

这些窗口指标只用于 **实盘风险决策**，不会反向修改已经封板的 v3.1 模型逻辑。

---

## 4. 红黄绿灯风控规则（资金仓位调节）

本节给出一套 **可执行的、量化的实盘仓位管理规则**。可根据个人风险偏好稍作微调，但不建议频繁改动。

设：

- `R60 = window60_return`，`DD60 = window60_max_drawdown`，`S60 = window60_sharpe`
- `R120, DD120, S120` 对应 120 天窗口；
- `R240, DD240, S240` 对应 240 天窗口。

### 4.1 绿灯（风格顺风，可正常或逐步加仓）

满足全部条件时，判定为 **绿灯**：

- 长期健康：`R240 > 0` 且 `S240 > 0.5`；
- 中期不差：`R120 >= 0` 且 `S120 >= 0.3`；
- 短期未被重锤：`R60 >= -0.03` 且 `DD60 > -0.08` 且 `S60 >= 0`。

**操作建议：**

- 若当前仅小仓试运行，可在 1–2 个月内分批将资金提升至目标仓位（例如从 5 万逐步加到规划额度）；
- 加仓时遵循“多次小步”原则，每次加仓不超过目标总额度的 20%。

### 4.2 黄灯（风格逆风，但长期仍健康）

满足以下任一情况，且长期仍为正时，判定为 **黄灯**：

- `R240 > 0` 但 `R60 < -0.03` 或 `S60 < 0`；
- 或 `R120` 小幅为负（如 `-0.08 < R120 < 0`），但 `R240` 仍明显为正，`DD240` 未突破历史容忍（例如 > -0.20）。

**操作建议：**

- 总资金上限收紧为目标额度的 **30%–50%**；
- 若当前实盘资金高于该比例，应在 1–2 周内有序减仓至该区间；
- 仍保持每日调仓和监控，但将此阶段定位为“风格回撤期”，心理上不追求短期盈利，只防止回撤失控。

### 4.3 红灯（风格或逻辑可能失效，应暂停加仓）

满足以下任一情况，判定为 **红灯**：

- `R240 <= 0`（近一年整体不赚钱）；
- 或 `DD240 < -0.25`（近一年最大回撤超过 25%）；
- 或 60 / 120 / 240 三个窗口的 Sharpe 长期为负（例如连续两次审计 `S60, S120, S240` 均 < 0）。

**操作建议：**

- 暂停所有加仓，仅保留极小实验仓位（如 5 万级别或更少），或直接降为纸上实盘；
- 启动专项诊断：
  - 重新跑完整 VEC + BT 对齐；
  - 检查因子表现、ETF 池是否存在结构性变化（政策、流动性、交易制度）；
- 若连续 2–3 轮（月度级）仍为红灯，可考虑将本策略降级为“备用策略”，不再作为主线配置。

---

## 5. 首次上线建议流程（以 5 万资金为例）

1. **前置条件检查：**
   - 运行一次：
     - `uv run python scripts/recent_bt_audit.py --topn 5 --windows 60 120 240`
   - 确认当前状态：
     - 若为明显红灯（最近 60 天亏损 > 10%，Sharpe 明显为负），建议先纸上跟踪 1–2 个月，再考虑真金白银；
     - 若介于黄灯 / 绿灯边界，可用 5 万小仓开始试运行。

2. **试运行阶段（约 1–3 个月）：**
   - 资金规模：5 万；
   - 完全按照模型信号执行，禁止“人工择时”（不上、不下）；
   - 每月固定日期跑一次 multi-window 审计，并记录当期 R60/R120/R240 等关键指标；
   - 重点观察：
     - 实盘成交价与模型价格的偏差是否可接受；
     - 日内滑点 / 盘口流动性是否会系统性拉低收益。

3. **试运行结束复盘：**
   - 若现实表现与回测窗口表现大致一致，且多窗口状态处于黄灯向绿灯过渡，可考虑按 20%–30% 的步长逐步加仓；
   - 若现实表现明显劣于回测（例如实盘滑点远超预期），需先解决执行问题，再谈放大资金。

---

## 6. 日常 Checklist（简版）

每日（收盘后）：

- [ ] 生成当日调仓信号；
- [ ] 券商端下单与成交确认；
- [ ] 留档：当日目标持仓 vs 实际成交对账。

每周 / 每月：

- [ ] 运行 multi-window BT 审计脚本；
- [ ] 更新 R60/R120/R240 指标，并判断红黄绿灯状态；
- [ ] 若状态由绿转黄 / 黄转红，按规则调整仓位上限；
- [ ] 若出现连续红灯，启动专项诊断而非继续加仓。

---

## 7. 心理预期与纪律

- 接受事实：
  - 这是一个 **长期进攻型策略**，不会在任何市场环境下都赚钱；
  - 震荡 / 绞肉机阶段出现 10%–15% 的阶段性回撤是历史上已经发生过、且在容忍范围内的行为。
- 真正带来价值的，是：
  - **有纪律地控制给策略“玩”的资金规模**；
  - **用多窗口指标和清晰规则，限制自己在最难受的时候做出情绪化决策。**

只要上述执行与风控规则得到落实，即使未来一段时间仍处于震荡期，这条 v3.1 策略线依然可以作为组合中的一台合格“进攻引擎”，等待属于它的那一轮趋势行情。
