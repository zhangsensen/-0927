# 📊 Top1000 BT 审计报告

> **审计时间**: 2025-12-01  
> **策略来源**: `selection_v2_20251201_205903/all_combos_scored.parquet`  
> **审计策略数**: 1000 个  
> **结果目录**: `results/bt_audit_top100_20251201_210741/`

---

## 📈 核心统计

| 指标 | 数值 | 说明 |
|------|------|------|
| **有效策略** | 982/1000 (98.2%) | 正常完成回测 |
| **NaN 策略** | 18 | 回测中断，需调查 |
| **平均 VEC/BT 差异** | 4.29pp | 包含高差异策略 |
| **中位数差异** | 0.12pp | 大部分策略对齐良好 |
| **最大差异** | 56.88pp | 见高风险因子分析 |

---

## 🎯 差异分布

```
差异区间          数量      占比       累计
─────────────────────────────────────────
< 0.1pp          460      46.8%     46.8%  ✅ 精确对齐
0.1pp ~ 1.0pp    135      13.8%     60.6%  ✅ 高度可信
1.0pp ~ 5.0pp    101      10.3%     70.9%  ⚠️ 可接受
5.0pp ~ 10.0pp   143      14.6%     85.4%  ⚠️ 需关注
10.0pp ~ 20.0pp   93       9.5%     94.9%  🔴 高风险
>= 20.0pp         50       5.1%    100.0%  🔴 需排除
```

**关键发现**:
- **60.6%** 策略差异 < 1pp（高度可信）
- **70.9%** 策略差异 < 5pp（生产可用）
- **14.6%** 策略差异 >= 10pp（需排除或调查）

---

## 🏆 BT 收益 Top 10 策略

| 排名 | BT 收益 | VEC 收益 | 差异 | MaxDD | 组合 |
|------|---------|----------|------|-------|------|
| 25 | **238.04%** | 237.52% | 0.52pp ✅ | 14.2% | ADX_14D + MAX_DD_60D + PRICE_POSITION_120D + PRICE_POSITION_20D + SHARPE_RATIO_20D |
| 69 | 227.62% | 226.26% | 1.36pp ✅ | 16.0% | MAX_DD_60D + MOM_20D + SHARPE_RATIO_20D + VORTEX_14D |
| 140 | 226.88% | 226.88% | 0.00pp ✅ | 21.9% | CORRELATION_TO_MARKET_20D + MAX_DD_60D + PRICE_POSITION_120D + PRICE_POSITION_20D |
| 129 | 226.80% | 227.07% | 0.28pp ✅ | 16.0% | MAX_DD_60D + RELATIVE_STRENGTH_VS_MARKET_20D + SHARPE_RATIO_20D + VORTEX_14D |
| 502 | 225.46% | 225.29% | 0.17pp ✅ | 14.5% | ADX_14D + MAX_DD_60D + PRICE_POSITION_120D + SHARPE_RATIO_20D |
| 85 | 223.09% | 222.51% | 0.59pp ✅ | 17.9% | ADX_14D + MAX_DD_60D + MOM_20D + PRICE_POSITION_120D |
| 24 | 223.08% | 221.62% | 1.46pp ✅ | 19.3% | MAX_DD_60D + MOM_20D + PRICE_POSITION_20D + SHARPE_RATIO_20D + VORTEX_14D |
| 176 | 218.99% | 198.31% | 20.69pp ⚠️ | 19.6% | MAX_DD_60D + MOM_20D + RELATIVE_STRENGTH_VS_MARKET_20D + SHARPE_RATIO_20D + VORTEX_14D |
| 63 | 217.44% | 217.90% | 0.47pp ✅ | 17.9% | ADX_14D + MAX_DD_60D + PRICE_POSITION_120D + RELATIVE_STRENGTH_VS_MARKET_20D |
| 28 | 212.90% | 212.98% | 0.08pp ✅ | 19.3% | MAX_DD_60D + PRICE_POSITION_20D + RELATIVE_STRENGTH_VS_MARKET_20D + SHARPE_RATIO_20D + VORTEX_14D |

**最佳策略确认**:
```
Rank 25: ADX_14D + MAX_DD_60D + PRICE_POSITION_120D + PRICE_POSITION_20D + SHARPE_RATIO_20D
- BT 收益: 238.04%
- VEC 收益: 237.52%
- 差异: 0.52pp ✅
- 最大回撤: 14.2%
- 状态: 生产可用
```

---

## 🥇 黄金策略（BT > 100% && diff < 1pp）

**共 282 个策略**符合"黄金策略"标准：
- BT 实盘验证收益 > 100%
- VEC/BT 差异 < 1pp（高度对齐）

这些策略具有：
1. ✅ 高收益潜力
2. ✅ 回测结果可复现
3. ✅ VEC 与 BT 高度一致

---

## 🔴 高风险因子分析

### 因子风险等级

| 因子 | 平均差异 | 出现次数 | 风险等级 |
|------|----------|----------|----------|
| **VOL_RATIO_60D** | 13.86pp | 170 | 🔴 高风险 |
| MAX_DD_60D | 7.60pp | 234 | 🟡 中风险 |
| VOL_RATIO_20D | 6.77pp | 273 | 🟡 中风险 |
| RSI_14 | 5.38pp | 49 | 🟡 中风险 |
| SHARPE_RATIO_20D | 4.64pp | 515 | 🟢 低风险 |
| MOM_20D | 4.54pp | 464 | 🟢 低风险 |
| 其他因子 | < 4.5pp | - | 🟢 低风险 |

### VOL_RATIO 因子详细分析

| 组合 | 策略数 | 平均差异 | 差异<1pp | 差异>10pp |
|------|--------|----------|----------|-----------|
| 仅 VOL_RATIO_20D | 242 | 4.33pp | 105 | 31 |
| 仅 VOL_RATIO_60D | 139 | 11.18pp | 11 | 57 |
| **VOL_RATIO_20D + 60D** | 31 | **25.85pp** | 1 | 26 |
| 不含 VOL_RATIO | 570 | 1.42pp | 454 | 29 |

**结论**: 
- `VOL_RATIO_60D` 应标记为风险因子
- `VOL_RATIO_20D + VOL_RATIO_60D` 组合应禁止使用
- 不含 VOL_RATIO 的策略平均差异仅 1.42pp

---

## ⚠️ NaN 策略分析

### 18 个 NaN 策略特征

| Rank | VEC 收益 | 交易数 | 共同因子 |
|------|----------|--------|----------|
| 12 | 206.97% | 112 | VOL_RATIO_20D, CORRELATION_TO_MARKET_20D |
| 13 | 206.80% | 111 | VOL_RATIO_20D, CORRELATION_TO_MARKET_20D |
| 149 | 165.15% | 110 | VOL_RATIO_20D, VOL_RATIO_60D |
| 173 | 153.78% | 109 | VOL_RATIO_20D, VOL_RATIO_60D |
| ... | ... | ... | ... |

**NaN 因子频率**:
- VOL_RATIO_20D: 17/18 (94.4%) ⚠️
- VOL_RATIO_60D: 8/18 (44.4%)
- CORRELATION_TO_MARKET_20D: 10/18 (55.6%)

**根本原因**:
- 在 2022-09 附近，某些 VOL_RATIO 因子组合无法产生有效信号
- 导致 BT 引擎无法正确计算 equity
- 交易记录中出现 NaN pnl 的交易

---

## 📋 建议与行动

### 1. 因子处置建议

| 因子 | 建议 | 理由 |
|------|------|------|
| **VOL_RATIO_60D** | 🔴 标记为风险因子 | 平均差异 13.86pp |
| **VOL_RATIO_20D + 60D** | 🔴 禁止组合使用 | 平均差异 25.85pp |
| OBV_SLOPE_10D | 🔴 已标记 | VEC/BT 差异 61pp |
| CMF_20D | 🔴 已标记 | VEC/BT 差异 35pp |

### 2. 策略筛选更新

建议在 `select_strategy_v2.py` 中增加：
```python
# 新增风险因子
RISKY_FACTORS = ["OBV_SLOPE_10D", "CMF_20D", "VOL_RATIO_60D"]

# 禁止组合
BANNED_COMBOS = [("VOL_RATIO_20D", "VOL_RATIO_60D")]
```

### 3. 生产策略池

过滤后的安全策略：
- 从 6,635 个生产就绪组合中
- 移除含 VOL_RATIO_60D 的组合（约 2,000 个）
- 移除 VOL_RATIO_20D + 60D 组合
- 剩余约 4,500 个安全策略

---

## 📊 BT 审计核心指标

| 指标 | 数值 |
|------|------|
| 收益 > 200% | 15 个 |
| 收益 > 150% | 110 个 |
| 收益 > 100% | 485 个 |
| 最大回撤 < 15% | 67 个 |
| 最大回撤 < 20% | 479 个 |
| 平均胜率 | 48.9% |
| 平均最大回撤 | 19.82% |

---

## ✅ 审计结论

### 整体评估: **通过** ✅

1. **VEC/BT 对齐质量优秀**
   - 60.6% 策略差异 < 1pp
   - 70.9% 策略差异 < 5pp
   - 中位数差异仅 0.12pp

2. **发现并定位风险因子**
   - VOL_RATIO_60D: 高风险
   - VOL_RATIO_20D + 60D 组合: 极高风险
   - 已识别 NaN 策略的根本原因

3. **最佳策略稳定可靠**
   - Rank 25 策略: 238.04% 收益，0.52pp 差异
   - 282 个黄金策略可用于生产

4. **建议行动**
   - 更新 `RISKY_FACTORS` 列表
   - 添加禁止组合规则
   - 重新运行策略筛选

---

**审计完成** | **报告生成时间**: 2025-12-01
