# 改造计划与路线图

> **最后更新**: 2025-11-28  
> **状态**: 进行中

---

## 已完成 ✅

### Phase 1: VEC/BT 对齐（2025-11-27 ~ 2025-11-28）

| 任务 | 状态 | 说明 |
|------|------|------|
| 修复 BT 资金计算时序 | ✅ | 使用卖出后现金 |
| 修复 Margin 订单失败 | ✅ | Broker 配置调整 |
| 修复 VEC 浮点精度 | ✅ | 添加 0.01% 容差 |
| 修复择时信号滞后 | ✅ | `shift_timing_signal` |
| 统一调仓日程 | ✅ | `generate_rebalance_schedule` |
| 验证对齐 | ✅ | 差异 < 0.01pp |

### Phase 2: 代码整理（2025-11-28）

| 任务 | 状态 | 说明 |
|------|------|------|
| 清理调试脚本 | ✅ | 删除 12 个文件 |
| 整理文档 | ✅ | 创建 docs/ 结构 |
| 创建备份 | ✅ | backup_20251128/ |

---

## 进行中 🔄

### Phase 3: 文档完善

| 任务 | 状态 | 说明 |
|------|------|------|
| README.md | ✅ | 项目总览 |
| ARCHITECTURE.md | ✅ | 架构说明 |
| DEVELOPMENT_NOTES.md | ✅ | 开发注意事项 |
| 清理旧文档 | 🔄 | 进行中 |

---

## 待完成 📋

### Phase 4: 测试完善

| 任务 | 优先级 | 说明 |
|------|--------|------|
| 添加 VEC/BT 一致性测试 | 高 | 自动化验证 |
| 添加因子计算测试 | 中 | 确保无前视偏差 |
| 添加调仓逻辑测试 | 中 | 确保 set 有序 |

### Phase 5: 性能优化

| 任务 | 优先级 | 说明 |
|------|--------|------|
| WFO 并行化 | 低 | 多核加速 |
| 因子缓存优化 | 低 | 减少重复计算 |

### Phase 6: 功能扩展

| 任务 | 优先级 | 说明 |
|------|--------|------|
| 支持更多因子 | 低 | 扩展因子库 |
| 支持更多 ETF | 低 | 扩展标的池 |
| 实盘对接 | 低 | 交易接口 |

---

## 技术债务

### 已清理

- [x] 重复的调试脚本
- [x] 过期的文档
- [x] 混乱的根目录

### 待清理

- [ ] `etf_rotation_experiments/` - 考虑合并到主目录
- [ ] `docs/` 中的旧文档 - 待完全清理
- [ ] `results/` 中的旧结果 - 定期清理

---

## 版本计划

### v2.0（当前）
- ✅ VEC/BT 严格对齐
- ✅ 三层引擎架构
- ✅ 代码整理

### v2.1（计划）
- 自动化测试
- CI/CD 集成

### v3.0（远期）
- 实盘对接
- 监控系统

---

## 决策记录

### 2025-11-28: WFO 不对齐到 VEC/BT

**背景**：WFO 数值与 VEC/BT 不同（234% vs 70%）

**决策**：不修改 WFO 内核

**原因**：
1. WFO 是粗筛器，排序稳定即可
2. 修改 numba 内核风险高
3. 真相源已有（VEC/BT）

**影响**：WFO 继续作为筛选层使用，收益以 VEC/BT 为准
