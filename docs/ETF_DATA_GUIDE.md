# ETF 数据全景指南

本文档详细说明了 `raw/ETF/` 目录下各类数据的含义、用途及局限性，帮助开发者理解策略的数据基础。

> **最后更新**: 2026-02-12
> **适用于**: 所有 ETF 相关策略开发

---

## 📂 数据目录概览

| 目录路径 | 数据类型 | 核心价值 | 更新频率 |
| :--- | :--- | :--- | :--- |
| `daily/` | 价格动量 (复权) | **策略核心**，计算所有 OHLCV 因子 | 日更 |
| `fund_daily/` | 真实成交价 | 折溢价计算基准，实盘对账 | 日更 |
| `fund_nav/` | 基金净值 (NAV) | 衡量基金内在价值，计算折溢价 | 日更 |
| `fund_share/` | 份额变动 | **机构行为代理**，最强 Alpha 源之一 | 日更 |
| `factors/premium_rate` | 折溢价率 | 市场情绪温度计，套利机会识别 | 日更 (衍生) |
| `fx/` | 汇率 (QDII) | QDII 收益归因，风险分解 | 日更 |
| `margin/` | 融资融券 | 杠杆资金情绪，多空博弈 | 日更 |
| `moneyflow/` | 资金流向 | (目前不可用) 理论上的微观结构数据 | 日更 |
| `snapshots/` | 实盘快照 | 盘中监控，实时 IOPV | 实时/高频 |

---

## 1. `daily/` — 价格动量的全部基础

**代表什么**：  
市场对这只 ETF 的定价共识。  
关键特征是**前复权 (Forward Adjusted)**：消除了分红、拆分导致的价格断裂，保证收益率在时间序列上是连续可比的。

**核心价值**：  
- **策略地基**：目前策略中的 18 个因子（SLOPE, SHARPE, ADX, OBV 等）全部基于此数据计算。
- **回测基准**：策略回测时的买入卖出价格依据。

**局限性**：  
- **历史失真**：因为是前复权，历史价格被修改过，不能与当时的 NAV 直接比较（否则折溢价计算会出错）。
- **不可用于对账**：实盘交易的是真实价格，不是复权价格。

---

## 2. `fund_daily/` — 真实成交价

**代表什么**：  
当天投资者在二级市场实际买卖的价格，**没有任何调整**。  
`close = 4.733` 就意味着当天收盘时的真实成交价就是 4.733 元。

**核心价值**：  
- **折溢价计算**：必须用真实价格 `close` 与 `unit_nav` 比较计算折溢价率（`close / unit_nav - 1`）。
- **数据验证**：用于验证 `daily/` 中的复权数据是否存在异常。
- **日内因子潜力**：未来如果开发日内因子（如开盘跳空缺口、真实振幅），需要使用真实价格。

**与 `daily/` 的区别**：  
- `daily/` 给**策略回测**用（需要连续收益率）。
- `fund_daily/` 给**折溢价分析**和**实盘对账**用。

---

## 3. `fund_nav/` — 基金真正值多少钱

**代表什么**：  
基金管理人每天收盘后，按照持仓证券的市值计算出的"内在价值" (Net Asset Value)。  
对于 ETF，NAV 是底层一篮子股票（或资产）的加权净值。

**核心价值**：  
- **价值锚点**：折溢价因子的分母。`close > NAV` 说明二级市场给了溢价，投资者在"抢筹"。
- **QDII 溢价指示**：
    - 纳指 ETF 溢价 +2.6%，说明国内投资者愿意多付 2.6% 买美股敞口（可能源于额度稀缺、汇率预期或极端情绪）。
- **A股 ETF 均值回归**：
    - 由于有申赎套利机制，A股 ETF 的折溢价通常接近 0%。一旦出现偏离，通常会被套利资金快速纠正，偏离的方向和速度包含信息量。

**⚠️ 口径陷阱**：  
- **公告延迟**：`ann_date` 通常是 `trade_date + 1`。NAV 是 T 日收盘算的，但 T+1 日才公告。
- **回测注意**：在回测中，用 T 日的 NAV 计算信号只能在 T+1 日交易，否则会引入前视偏差 (Look-ahead Bias)。

---

## 4. `fund_share/` — 机构在投票

**代表什么**：  
ETF 的总份额变动 = 净申购 - 净赎回。  
份额增加说明有人在一级市场申购（通常是机构），份额减少说明在赎回。

**核心价值**：  
- **机构行为代理**：散户一般不走申赎通道（门槛高、需要一篮子股票），份额变动主要反映**机构资金**的流向。
- **强 Alpha 信号**：
    - IC 验证显示 `SHARE_CHG_10D` IC = -0.055 (Rank IC -0.113)。
    - **反向指标**：份额大幅增加 → 后续收益往往较差（可能是机构"接盘"或套利盘压制）。
- **独立信息源**：这是 OHLCV 之外的独立信息维度。Kaiser 分析指出量价因子有效维度只有 5，而份额变动来自完全不同的通道。

**局限性**：  
- **净结果**：只显示当天的净申购/赎回结果，无法看到日内的申赎过程。

---

## 5. `factors/premium_rate` — 市场定价偏差

**代表什么**：  
二级市场价格相对 NAV 的偏离程度。  
- **溢价 (>0)**：投资者愿意多付钱买。
- **折价 (<0)**：投资者想卖但流动性不足或情绪悲观。

**核心价值**：  
- **QDII 温度计**：纳指 ETF 溢价从 +1% 飙升到 +10% 时，说明资金疯狂涌入但 QDII 额度有限。历史上溢价极端时往往是短期顶部。
- **微观结构压力**：A股 ETF 的异常偏离反映了市场微观结构的压力（如大额赎回冲击、流动性枯竭）。
- **稳定性**：`PREMIUM_DEV_20D` 的 IC 极其稳定 (-0.046)，训练集与样本外 (OOS) 几乎无衰减。
- **均值回复**：折溢价有天然的套利锚定，不像动量因子那样依赖市场状态 (Regime)，具有很强的均值回复特性。

---

## 6. `fx/` — QDII 的隐藏收益/风险

**代表什么**：  
人民币兑美元 (USD/CNY) 或港元 (HKD/CNY) 的汇率变动。

**核心价值**：  
- **收益归因**：纳指 ETF 的收益 = 标普表现 + 汇率变动 + 折溢价变动。如果不做分解，你不知道赚的是美股 Alpha 还是人民币贬值的 Beta。
- **FX Beta 因子**：当 USD/CNH 上涨（人民币贬值）时，QDII ETF 自动受益。如果策略选了 QDII 主要是因为赚汇率，那不是真正的 Alpha。
- **数据源互补**：
    - `USDCNH.FXCM`：离岸市场真实交易价，波动大，适合做因子。
    - `BOC 中间价`：央行管控锚，波动小，适合做归因。

**重要性**：  
虽然目前策略主要持仓 A股，但未来如果引入 QDII 标的，不理解 FX 暴露就等于"裸奔"。

---

## 7. `margin/` — 杠杆情绪

**代表什么**：  
融资融券数据。  
- **融资**: 借钱买入（杠杆做多）。
- **融券**: 借券卖出（做空）。

**核心价值**：  
- **融资余额 (rzye)**：杠杆多头的存量。持续上升说明有人加杠杆看多。
- **融券余量 (rqyl)**：卖空存量。上升说明有人在做空。
- **融资买入额 (rzmre)**：当日新增杠杆，比存量更灵敏。
- **潜在因子**：
    - 杠杆密度 = `rzye / 流通市值`
    - 杠杆占比 = `rzmre / 成交额`
    - 多空情绪 = `融资 / 融券`

**局限性**：  
- **覆盖率**：不是所有 ETF 都是两融标的。小规模 ETF（如 516520）数据很少。

---

## 8. `moneyflow/` — 知道谁在买（☠️ 数据受损）

**代表什么**：  
按订单大小分类的资金流向。  
- 超大单 (>100万)：机构
- 大单 (20-100万)：大户
- 中/小单：散户

**理论价值**：  
- 主力净流入持续为正 → 机构吸筹。
- 小单净流入为正但大单流出 → 散户接盘、机构出货。

**现实状况**：  
- **数据不可用**：目前数据存在列错位问题，且只有 120 天历史数据。
- **替代方案**：实盘监控可以从 `snapshots/` 字段里看实时资金流。

---

## 9. `snapshots/` + `realtime/` — 实盘快照

**代表什么**：  
某一时刻全市场 ETF 的完整截面状态。

**核心价值**：  
- **IOPV (实时参考净值)**：盘中折溢价的分母，比收盘 NAV 更及时。
- **盘中资金流**：弥补 `moneyflow/` 的历史不足，实时监控资金流向。
- **微观指标**：包含实时份额、委比、量比等高频指标。
- **用途**：专用于实盘监控和信号校验，**不用于回测**。

---

## 🌟 总结：信息层次模型

我们对 ETF 市场的理解可以分为 5 个层次，目前策略正在从第 1 层向第 2、3 层进化。

| 层次 | 核心数据 | 状态 | 说明 |
| :--- | :--- | :--- | :--- |
| **第 1 层** | **价格 (daily)** | ✅ 已饱和 | 现有 18 个因子全部源于此。Kaiser 分析显示有效维度 (5/17) 已接近饱和。 |
| **第 2 层** | **价值锚 (fund_nav + fund_daily)** | 🚀 进阶中 | **折溢价因子**，IC 稳定 (-0.046)。QDII 折溢价是完全独立的信息源。 |
| **第 3 层** | **资金行为 (fund_share + margin)** | 🚀 进阶中 | **份额变动** IC 最强 (-0.055 -> -0.113)。与价格正交，是突破 OHLCV 瓶颈的关键。 |
| **第 4 层** | **宏观环境 (fx)** | 🔄 储备中 | QDII 归因和风险分解必备。 |
| **第 5 层** | **微观结构 (moneyflow)** | ❌ 暂不可用 | 数据损坏，且历史长度不足。 |

**核心判断**：  
**第 2 层和第 3 层是下一步 Alpha 的最大来源**。  
OHLCV 因子空间已经拥挤，但 `fund_share` (份额) 的 IC 比很多量价因子都强，且信息来源完全独立。理解并利用这些数据是提升策略表现的关键。
