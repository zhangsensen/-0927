# 🚀 实盘执行 SOP (Standard Operating Procedure)

> **策略**: Golden Strategy v3.1 (ETF 轮动)  
> **频率**: 每日检查 (FREQ=3 逻辑由脚本内部处理，建议每日运行以监控排名变化)  
> **执行窗口**: 14:50 - 14:55 (收盘前)

---

## 📋 每日流程 (Daily Routine)

### 1. 准备数据 (14:45)
确保本地数据已更新至今日（或昨日收盘）。

```bash
# 更新数据 (假设使用 akshare/tushare)
uv run python src/etf_data/scripts/quick_download.py
```

### 2. 生成信号 (14:50)
运行每日信号生成脚本，获取目标持仓。

```bash
uv run python scripts/run_daily_signal.py
```

**输出示例**:
```text
🏆 交易信号 | 日期: 2025-12-02 | 策略: Golden Strategy v3.1
...
💡 交易建议 (14:50 执行):
   买入/持有: 518880 (黄金ETF), 513100 (纳指100)

⚠️  注意: 包含 QDII ETF。
   - 请忽略 IOPV 溢价 (结构性成本)
   - 建议使用限价单 (Limit Order) 在卖一/买一价之间成交
```

### 3. 执行交易 (14:50 - 14:55)

#### A. 检查持仓
- 对比 **当前持仓** 与 **建议持仓**。
- 如果建议持仓与当前不同，且排名差异显著（例如原持仓跌出 Top 5），则进行调仓。
- **注意**: 策略默认 `FREQ=3` (每3天调仓)，但脚本每天都会给出"当前最优"。
  - **严格执行**: 仅在持有期满 3 天后调仓。
  - **动态执行**: 如果新信号极强 (Top 1)，可提前换仓 (自行判断)。

#### B. 下单技巧
- **QDII ETF (513100, 513500 等)**:
  - **忽略溢价**: 不要因为溢价 (IOPV Premium) 而放弃交易。这是结构性成本。
  - **限价单 (Limit Order)**: 挂在 **卖一价 (Ask 1)** 买入，**买一价 (Bid 1)** 卖出。
  - **禁止市价单**: 防止瞬间滑点。
- **A股 ETF**:
  - 直接对手价成交即可。

### 4. 记录日志 (15:00)
- 记录实际成交价格和数量。
- 记录当时的溢价率（仅供参考）。

---

## ⚠️ 风险控制 (Circuit Breakers)

如果遇到以下情况，**暂停开新仓** (只卖不买):

1. **市场熔断**: 大盘跌幅 > 7%。
2. **数据异常**: 脚本报错或数据未更新。
3. **极端溢价**: QDII 溢价率 > 5% (虽然我们忽略溢价，但极端高溢价可能预示风险)。

---

## 🛠️ 故障排除

**Q: 脚本报错 `KeyError: 'volume'`?**
A: 数据源格式变更。请检查 `raw/ETF/daily` 下的 parquet 文件列名。

**Q: 信号全是现金/国债?**
A: 可能是市场普跌，策略触发风控（MAX_DD_60D 飙升），自动切换到避险资产。**请严格执行**。

**Q: 纳指涨了，为什么没选?**
A: 策略是多因子综合打分 (ADX + DD + Position + Sharpe)。单一涨幅不代表综合得分高。相信模型。
