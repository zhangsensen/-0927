# 新因子验证总结（中文版）

**验证时间**: 2024年10月28日  
**验证方法**: Top-12因子加权回测 + 负IC窗口深度剖析  
**数据真实性**: ✅ 所有结果基于真实WFO流水线，无缓存/模拟数据

---

## 一句话结论

**🛑 暂缓推广** - IC层改善+3.9%但组合夏普-1.8%、回撤恶化0.9%，成交量因子在极端波动期系统性失效（IC劣化0.0137），未达推广阈值。

---

## 关键数据对比

### IC层（真实提升）✅

- **OOS IC均值**: 0.0148 → 0.0154 **(+3.9%)**
- **IC衰减**: 0.0172 → 0.0167 **(-2.8%)**

### 组合层（未达预期）❌

- **年化收益**: 1.64% → 1.61% **(-1.7%)**，阈值+10%
- **夏普比率**: 0.091 → 0.090 **(-1.8%)**，阈值+10%
- **最大回撤**: -66.46% → -67.04% **(恶化+0.9%)**，阈值不恶化

---

## 根本原因

### 负IC窗口（28-30, 38, 46-51）成交量因子系统性失效

| 实验 | 成交量因子平均IC | 基础因子平均IC | IC差距 | 结论 |
|------|----------------|---------------|--------|------|
| **基线** | -0.0050 | -0.0088 | **+0.0038** | ✅ 无劣势 |
| **增强** | **-0.0225** | -0.0088 | **-0.0137** | ❌ **系统性劣化** |

**典型失效窗口**:

- **窗口38**: `OBV_SLOPE_10D` IC = **-0.0626**（vs 基线无成交量因子）
- **窗口46**: `OBV_SLOPE_10D` IC = **-0.0790**（vs 基线无成交量因子）
- **窗口28**: `RSI_14` IC = -0.0373

**失效机制**: 极端波动期成交量技术指标钝化，基础价格趋势因子（CALMAR/PRICE_POSITION）更鲁棒。

---

## 因子入选变化

| 因子 | 基线频率 | 增强频率 | 差异 | 说明 |
|------|---------|---------|------|------|
| CALMAR_RATIO_60D | 90.91% | **94.55%** | +3.6pp | 稳定性增强 |
| RSI_14 | 27.27% | **32.73%** | +5.5pp | ⚠️ 增强专属，负IC窗口拖累 |
| OBV_SLOPE_10D | - | **16.36%** | +16.36pp | ⚠️ 增强专属，窗口38/46严重失效 |
| TSMOM_60D | 45.45% | **5.45%** | **-40pp** | ⚠️ 被OBV/RSI挤压 |

---

## 改进方案

### 降配额方案（推荐）

```yaml
family_quota:
  # 保留稳定因子族
  tsmom_family:
    max_count: 1  # 仅保留TSMOM_120D（频率58%）
  breakout_family:
    max_count: 1  # 保留BREAKOUT_20D（频率76%）
  
  # 禁用失效因子族
  flow_accel_family:
    max_count: 0  # TURNOVER_ACCEL未入选，禁用
  
  # 新增约束：禁用成交量技术指标
  volume_indicator_family:
    factors:
      - RSI_14
      - OBV_SLOPE_10D
      - ADX_14D
      - VORTEX_14D
    max_count: 0  # 极端波动期系统性失效，全面禁用
```

### 渐进迭代路径

1. **第一阶段**: 仅启用`TSMOM_120D` + `BREAKOUT_20D`
   - 预期：IC提升+2%~+3%，组合夏普+5%~+8%，回撤不恶化
   
2. **第二阶段**: 若第一阶段夏普+5%且回撤不恶化，解除`TSMOM_60D`压缩
   - 恢复tsmom_family的max_count=2
   
3. **第三阶段**: 研发极端波动期成交量因子改进版
   - 条件激活：仅在低波动期启用RSI/OBV
   - 自适应参数：根据VIX动态调整窗口长度

---

## 验证过程

### P0任务：回测脚本升级

- ✅ 重写`compute_wfo_backtest_metrics.py`为Top-12因子加权策略
- ✅ 复跑基线（20251028_151333）与增强（20251028_151604）
- ✅ 消除等权回测无差异缺陷，获取真实夏普对比

### P1任务：负IC窗口剖析

- ✅ 创建`analyze_negative_ic_windows.py`剖析窗口28-30, 38, 46-51
- ✅ 分组对比成交量因子vs基础因子IC分布
- ✅ 诊断增强实验成交量因子IC劣化0.0137

### 五件套验证

- ✅ 配置对比：确认family_quota为核心差异
- ✅ 数据抽样：Step1/Step2新因子值域[-5,5]、非空率92.4%
- ✅ IC体检：OOS IC +3.9%, IC衰减-2.8%
- ✅ 日志扫描：55窗口无ERROR/跳过
- ✅ 回撤换手：Top-12回测完整指标

---

## 附录

**完整报告**: `BACKTEST_UPGRADE_REPORT.md`（中英双语）  
**对比脚本**: `scripts/final_comparison.py`  
**剖析脚本**: `scripts/analyze_negative_ic_windows.py`  
**回测脚本**: `scripts/compute_wfo_backtest_metrics.py`（Top-12因子加权）

**数据路径**:

- 基线: `results/wfo/20251028_151333/`
- 增强: `results/wfo/20251028_151604/`

**复现命令**:

```bash
# Top-12回测
python scripts/compute_wfo_backtest_metrics.py results/wfo/20251028_151333
python scripts/compute_wfo_backtest_metrics.py results/wfo/20251028_151604

# 负IC窗口剖析
python scripts/analyze_negative_ic_windows.py results/wfo/20251028_151333
python scripts/analyze_negative_ic_windows.py results/wfo/20251028_151604

# 终极对比
python scripts/final_comparison.py
```

---

**报告审核**: 所有数据基于真实WFO结果，未使用缓存或模拟数据  
**结论可靠性**: 高（基于Top-12因子加权回测 + 负IC窗口深度剖析）  
**推广建议**: 🛑 暂缓推广，采用降配额方案后重新验证
