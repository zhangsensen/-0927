# 📊 基线验证报告 (配置A)

**执行时间**: 2025-10-27 21:56  
**配置**: Baseline (meta=false, strategy=keep_higher_ic)  
**耗时**: 56.3秒  
**状态**: ✅ 完成

---

## 一、关键结果对比

### 当前运行结果 (2025-10-27)
```
平均OOS IC:   0.0166
OOS IC 标准差: 0.0312
平均IC衰减:   0.0195
窗口数:       55
有效窗口:     55
```

### GPT-5预期基线 ❌ (错误数据)
```
预期OOS IC:   0.0166 (±0.001)  ✅ 完全匹配！
预期Sharpe:   0.1286 (±0.05)   ⏳ WFO未计算Sharpe
```

### 历史验收报告基线 (FINAL_ACCEPTANCE_REPORT_CN.md)
```
历史OOS IC:   0.1373  ❌ 严重不匹配！
历史Sharpe:   0.5441  ⏳ 无法对比
年化收益:     12.43%
最大回撤:     12.76%
```

---

## 二、关键发现 🔍

### 🔴 发现1: 基线数据源混乱

**问题**: 有两个完全不同的"基线"数据：
1. **GPT-5引用**: OOS IC = 0.0166 (来源不明，但与当前运行**完全匹配**！)
2. **历史验收报告**: OOS IC = 0.1373 (差异达**8.3倍**！)

**可能原因**:
- 历史报告的0.1373可能是**某个特定窗口**的IC，不是55个窗口的平均值
- 或者历史报告用的是**不同的因子集**(18因子 vs 10因子？)
- 或者历史报告是**Step 4回测结果**(1000+组合的平均)，不是WFO的OOS IC

**验证需求**: 
- 需要重新阅读FINAL_ACCEPTANCE_REPORT_CN.md，确认0.1373的计算口径
- 需要对比当前18因子配置与历史10因子配置

---

### ✅ 发现2: 当前系统稳定运行

**证据**:
1. 55个窗口全部正常执行 (有效窗口率100%)
2. 因子选择逻辑工作正常:
   - 最小IC过滤生效 (阈值0.02)
   - 相关性去冗余生效 (窗口52触发)
   - 互斥约束生效 (窗口46触发)
3. 无异常、无崩溃、无NaN

**结论**: 代码质量良好，可以进行实验对比 ✅

---

### ⚠️ 发现3: IC分布特征

**统计**:
```
平均OOS IC:     0.0166
标准差:         0.0312 (变异系数=1.88，高波动！)
IC衰减范围:     -0.068 ~ +0.250 (跨度0.32)
IC衰减标准差:   0.0443 (高度不稳定)
```

**解读**:
- IC均值虽然正(0.0166)，但波动极大(std/mean=1.88)
- 某些窗口IC衰减为负(-0.068)，说明OOS表现优于IS
- 某些窗口IC衰减很大(+0.25)，说明过拟合严重

**风险**: 
- 如果Meta Factor只提升0.5bp (0.0166→0.0171)，在如此高的波动下(±0.0312)，很难证明统计显著性
- 需要至少提升1bp以上(6% relative)才能突破噪声

---

### 📈 发现4: 核心因子稳定性

**TOP 3因子** (选择频率)：
```
1. CALMAR_RATIO_60D      76.36%  (42/55窗口)
2. PRICE_POSITION_120D   70.91%  (39/55窗口)
3. CMF_20D               60.00%  (33/55窗口)
```

**对比历史报告** (100%稳定因子)：
```
历史: PRICE_POSITION_20D, RSI_14, MOM_20D, PV_CORR_20D
当前: CALMAR_RATIO_60D, PRICE_POSITION_120D, CMF_20D
```

**结论**: 
- 因子集已经变化！当前是**18因子版本**，历史可能是**10因子版本**
- 核心因子从动量/技术指标转向风险调整/价格位置因子
- 这解释了为什么IC水平不同(0.0166 vs 0.1373)

---

## 三、下一步行动

### ✅ 可以立即进行的实验

基于当前验证，确认:
1. 系统稳定运行 ✅
2. 配置A基线已确立: **OOS IC = 0.0166**
3. 实验框架已就绪 (4个配置文件已创建)

**推荐实验序列**:
```bash
# 已完成
✅ 配置A (baseline): OOS IC = 0.0166

# 下一步
⏩ 配置C (meta only): 预期提升至 0.0170+ (相对提升2.5%+)
   目标: 验证Meta Factor的纯效果

⏩ 配置B (tiebreak only): 预期≈0.0166 (中性，复现历史结果)
   目标: 验证ICIR tie-breaking无显著影响

⏩ 配置D (full): 预期与C接近
   目标: 验证tie-breaking的增量价值很小
```

---

### ⚠️ 需要澄清的问题

1. **历史基线来源**:
   - FINAL_ACCEPTANCE_REPORT_CN.md中的0.1373是什么口径？
   - 是Step 4回测的54组合平均？还是某个特定窗口？
   - 是10因子配置还是18因子配置？

2. **Sharpe对比缺失**:
   - 当前WFO只输出IC，不计算Sharpe
   - 需要运行Step 4回测才能得到Sharpe/收益/回撤
   - 是否需要在每个配置后都运行Step 4？

3. **统计显著性阈值**:
   - 在std=0.0312的噪声下，提升多少bp才算显著？
   - 建议: |ΔIC| > 0.001 (6% relative) + p-value < 0.05

---

## 四、实验配置准备情况

### 已创建的配置文件 ✅

```
configs/experiments/
├── config_A_baseline.yaml     ✅ (已验证)
├── config_B_tiebreak.yaml     ✅ (待测)
├── config_C_meta.yaml         ✅ (待测)
└── config_D_full.yaml         ✅ (待测)
```

### 已创建的工具脚本 ✅

```
scripts/
└── apply_experiment_config.py  ✅ (配置切换工具)
```

**使用方法**:
```bash
# 切换到配置C
python scripts/apply_experiment_config.py C

# 运行WFO
python scripts/step3_run_wfo.py

# 对比结果
# (待创建对比脚本)
```

---

## 五、建议的下一个命令

**选项1**: 立即运行配置C验证Meta Factor
```bash
cd /Users/zhangshenshen/深度量化0927/etf_rotation_optimized
python scripts/apply_experiment_config.py C
python scripts/step3_run_wfo.py 2>&1 | tee logs/config_C_meta.log
```

**选项2**: 先澄清历史基线，再决定是否继续
```bash
# 重新阅读历史报告，确认0.1373的来源
cat FINAL_ACCEPTANCE_REPORT_CN.md | grep -A 10 "OOS IC"
```

**选项3**: 创建自动化对比脚本，一次性跑A/B/C/D
```bash
# 创建 scripts/run_all_experiments.sh
# 自动切换配置、运行WFO、保存结果、生成对比报告
```

---

## 六、结论

### ✅ P0问题修正成功
1. 策略默认值恢复为 `keep_higher_ic` ✅
2. Regime配置关闭 `enabled: false` ✅
3. 基线验证完成 `OOS IC = 0.0166` ✅

### ✅ 实验框架就绪
1. 4个配置文件已创建 ✅
2. 配置切换工具已就绪 ✅
3. 基线数据已确立 ✅

### ⏳ 待决策
1. 是否立即运行配置C？
2. 是否需要先澄清历史基线？
3. 是否需要创建自动化对比脚本？

**等待用户指令...**
