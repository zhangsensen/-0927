<!-- ALLOW-MD --># 8天 WFO 流水线 - 执行总结

## ✅ 已完成操作

### 1. 流水线设计与实现
- **8天 WFO 全量运行脚本**：`scripts/run_8d_wfo_full.sh`
  - 固定 test_freq=8
  - 候选池：12,597 组合（18因子，size=[2,3,4,5]）
  - 并行度：8核
  - 预计耗时：~1小时

- **自动化流水线**：`scripts/auto_8d_wfo_pipeline.py`
  - 自动检测 WFO 完成
  - 提取合格组合白名单（IC>0.03, 稳定性>0.5）
  - 自动触发全频回测（30频率）
  - 生成频率泛化分析报告

- **监控脚本**：`scripts/monitor_8d_wfo.sh`
  - 后台守护，检查 WFO 进程
  - 完成后自动调用流水线

- **状态检查工具**：`scripts/check_8d_wfo_status.py`
  - 实时查看 4 个阶段状态
  - 显示进度和日志路径

### 2. 流水线启动
- **运行时间戳**：20251108_022132
- **WFO 进程 PID**：67730
- **状态**：✅ 运行中（已完成 434/12,597 任务，进度 3.4%）
- **监控进程 PID**：68722（后台守护）

### 3. 自动化机制
- WFO 完成后会自动触发全频回测
- 全频回测完成后自动生成分析报告
- 全程无需人工干预

---

## 📊 流水线架构

```
[8天 WFO 全量] (1小时)
    ↓ 自动触发
[提取白名单] (筛选 IC>0.03, 稳定性>0.5)
    ↓ 自动触发
[全频真实回测] (30频率 × 白名单组合，1-2小时)
    ↓ 自动触发
[频率泛化分析] (Spearman相关、分布统计，5分钟)
```

---

## 🎯 预期产出

### 1. 白名单组合数
- **预期**：3000-5000 组合
- **用途**：全频回测输入

### 2. 全频回测结果
- **文件**：`all_freq_scan_8d_wfo_qualified_20251108_022132.csv`
- **内容**：每个合格组合在 30 个频率的真实表现（含交易成本）

### 3. 频率泛化报告
- **文件**：`freq_generalization_report_20251108_022132.json`
- **关键指标**：
  - 各频率 Sharpe 分布（中位/P20/P80/IQR/>1.0占比）
  - 最佳频率分布（8天占比？16天占比？）
  - 8天 vs 其他频率秩相关（Spearman）
  - **泛化质量判断**：优秀(>0.7) / 良好(>0.5) / 一般(>0.3) / 差(<0.3)

---

## 🔬 验证目标

### 核心问题
**8天 WFO 筛选的组合，在其他频率上是否依然有效？**

### 判断标准
| Spearman中位数 | 泛化质量 | 结论 |
|----------------|----------|------|
| > 0.7 | **优秀** | ✅ 8天模型具备频率泛化能力，可作为统一排序基准 |
| 0.5 - 0.7 | **良好** | ⚠️ 8天模型有一定泛化能力，但谨慎跨频率推广 |
| 0.3 - 0.5 | **一般** | ⚠️ 8天模型仅适用高频，需分频率建模 |
| < 0.3 | **差** | ❌ 8天模型过拟合，回退多频率集成 |

### 次要指标
- **8天白名单在 16天的中位 Sharpe**：期望 ≥ 0.60（略低于 8天的 0.64）
- **8天白名单在 21天的中位 Sharpe**：期望 ≥ 0.50
- **最佳频率分布**：期望 8天占 40-50%，16天占 25-35%，其余分散

---

## 🔧 操作命令速查

### 查看当前状态
```bash
python scripts/check_8d_wfo_status.py
```

### 查看 WFO 日志（实时）
```bash
tail -f results/logs/wfo_8d_full_20251108_022132.log
```

### 查看监控日志（实时）
```bash
tail -f results/logs/monitor_8d_wfo_20251108_022132.log
```

### 手动触发流水线（如自动化失败）
```bash
python scripts/auto_8d_wfo_pipeline.py
```

---

## 📝 下一步决策树

### WFO 完成后（约1小时后）
1. **检查白名单组合数**
   - 若 < 1500：⚠️ 筛选过严，考虑降低 IC/稳定性阈值
   - 若 3000-5000：✅ 合理范围
   - 若 > 8000：⚠️ 筛选过松，考虑提高阈值

2. **等待全频回测完成**（自动触发，1-2小时）

3. **查看泛化报告**
   ```bash
   cat results_combo_wfo/20251108_022132/freq_generalization_report_20251108_022132.json
   ```

4. **根据泛化质量决策**
   - **优秀（>0.7）**：
     - ✅ 采用 8天 Ridge 模型 + λ=0.15 换手惩罚
     - ✅ 扩容到 Top3000/5000
     - ✅ 固定 8天频率为生产标准
   
   - **良好（0.5-0.7）**：
     - ✅ 采用 8天模型，但仅限 8天频率使用
     - ⚠️ 其他频率需独立建模或使用原稳健推荐
   
   - **一般/差（<0.5）**：
     - ❌ 8天模型不泛化
     - 回退多频率集成策略（21天为主 + 8/16/24 条件纳入）
     - 或分频率独立建模

---

## 📞 故障排查

### WFO 进程异常退出
```bash
# 查看错误日志
tail -n 100 results/logs/wfo_8d_full_20251108_022132.log

# 重启（会跳过已完成任务）
bash scripts/run_8d_wfo_full.sh
```

### 监控脚本失败
```bash
# 手动触发流水线
python scripts/auto_8d_wfo_pipeline.py
```

### 全频回测卡住
```bash
# 检查回测日志
tail -f results/logs/all_freq_scan_8d_wfo_*.log

# 检查内存使用
top -pid $(pgrep -f run_production_backtest)
```

---

## ⏱️ 预计完成时间

| 阶段 | 耗时 | 累计 |
|------|------|------|
| 8天 WFO | ~1 小时 | 1 小时 |
| 白名单生成 | 1 分钟 | 1 小时 |
| 全频回测 | ~1-2 小时 | 2-3 小时 |
| 分析报告 | 5 分钟 | 2-3 小时 |

**预计完成时刻**：约 2025-11-08 05:00（凌晨5点）

---

## ✨ 关键创新点

1. **统一锚点**：固定 8天频率作为筛选基准，避免"苹果比橙子"
2. **真实成本验证**：全频回测包含佣金/滑点，确保实盘可行性
3. **泛化能力量化**：用 Spearman 秩相关直接测量频率泛化强度
4. **全自动流水线**：从 WFO 到报告，零人工干预
5. **数据驱动决策**：不拍脑袋，用统计显著性指导下一步

---

## 📚 相关文档

- **操作手册**：`docs/8D_WFO_PIPELINE_MANUAL.md`
- **验证报告**（待生成）：`results_combo_wfo/20251108_022132/freq_generalization_report_20251108_022132.json`
- **WFO 日志**：`results/logs/wfo_8d_full_20251108_022132.log`
- **监控日志**：`results/logs/monitor_8d_wfo_20251108_022132.log`
