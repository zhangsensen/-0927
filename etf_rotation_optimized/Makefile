# ============================================================================
# ETFè½®åŠ¨ç³»ç»Ÿä¼˜åŒ–ç‰ˆ - Makefile
# ============================================================================
# é‡æ„æ—¥æœŸ: 2025-10-28
# æ¶æ„: æ¨ªæˆªé¢ -> å› å­ç­›é€‰ -> WFO -> VBTå›æµ‹
# ============================================================================

.PHONY: install test clean run run-steps help

# ============================================================================
# ç¯å¢ƒç®¡ç†
# ============================================================================

install:
	@echo "ğŸ“¦ å®‰è£…ä¾èµ–..."
	pip install -r requirements.txt

# ============================================================================
# æµ‹è¯•
# ============================================================================

test:
	@echo "ğŸ§ª è¿è¡Œæµ‹è¯•..."
	python -m pytest tests/ -v

# ============================================================================
# æ¸…ç†
# ============================================================================

clean:
	@echo "ğŸ§¹ æ¸…ç†ç¼“å­˜å’Œè¾“å‡º..."
	rm -rf cache/*
	rm -rf results/*
	rm -rf output/*
	find . -type d -name "__pycache__" -exec rm -rf {} + 2>/dev/null || true
	find . -type d -name "*.egg-info" -exec rm -rf {} + 2>/dev/null || true

# ============================================================================
# è¿è¡Œæµç¨‹
# ============================================================================

run:
	@echo "ğŸš€ è¿è¡Œå®Œæ•´æµç¨‹ï¼ˆæ¨ªæˆªé¢ -> å› å­ç­›é€‰ -> WFO -> å›æµ‹ï¼‰..."
	python main.py run --config configs/default.yaml

# è¿è¡Œå•ä¸ªæ­¥éª¤
run-cross-section:
	@echo "â–¶ï¸  è¿è¡Œæ¨ªæˆªé¢åŠ å·¥..."
	python main.py run-steps --config configs/default.yaml --steps cross_section

run-factor-selection:
	@echo "â–¶ï¸  è¿è¡Œå› å­ç­›é€‰..."
	python main.py run-steps --config configs/default.yaml --steps factor_selection

run-wfo:
	@echo "â–¶ï¸  è¿è¡ŒWFOéªŒè¯..."
	python main.py run-steps --config configs/default.yaml --steps wfo

run-backtest:
	@echo "â–¶ï¸  è¿è¡ŒVBTå›æµ‹..."
	python main.py run-steps --config configs/default.yaml --steps backtest

# ============================================================================
# å¸®åŠ©
# ============================================================================

help:
	@echo "============================================================================"
	@echo "ETFè½®åŠ¨ç³»ç»Ÿä¼˜åŒ–ç‰ˆ v2.0 - å¯ç”¨å‘½ä»¤"
	@echo "============================================================================"
	@echo ""
	@echo "ç¯å¢ƒç®¡ç†:"
	@echo "  make install              - å®‰è£…ä¾èµ–"
	@echo ""
	@echo "æµ‹è¯•:"
	@echo "  make test                 - è¿è¡Œæµ‹è¯•"
	@echo ""
	@echo "æ¸…ç†:"
	@echo "  make clean                - æ¸…ç†ç¼“å­˜å’Œè¾“å‡º"
	@echo ""
	@echo "è¿è¡Œæµç¨‹:"
	@echo "  make run                  - è¿è¡Œå®Œæ•´æµç¨‹"
	@echo "  make run-cross-section    - è¿è¡Œæ¨ªæˆªé¢åŠ å·¥"
	@echo "  make run-factor-selection - è¿è¡Œå› å­ç­›é€‰"
	@echo "  make run-wfo              - è¿è¡ŒWFOéªŒè¯"
	@echo "  make run-backtest         - è¿è¡ŒVBTå›æµ‹"
	@echo ""
	@echo "ç›´æ¥ä½¿ç”¨ main.py:"
	@echo "  python main.py run --config configs/default.yaml"
	@echo "  python main.py run-steps --config configs/default.yaml --steps cross_section"
	@echo ""
	@echo "============================================================================"
