<!-- ALLOW-MD -->
# ETF轮动策略 - 生产部署指南

## 策略概览

**版本**: v1.0_wfo_20251109  
**部署日期**: 2025-11-10  
**回测周期**: 2020-01-01 至 2025-10-14  
**数据来源**: WFO扫描 12,597个组合，筛选Top5  

---

## 一、策略组合配置

### 1.1 核心策略（5个）

| ID | 名称 | 权重 | Sharpe | 年化收益 | 最大回撤 | 因子数 |
|----|------|------|--------|----------|----------|--------|
| strat_001 | RSI_MaxDD_Momentum | 25% | 1.121 | 22.1% | -17.4% | 5 |
| strat_002 | RSI_CMF_Volatility | 25% | 1.132 | 23.4% | -21.0% | 5 |
| strat_003 | VOL_Position_Sharpe | 20% | 1.063 | 20.8% | -23.9% | 3 |
| strat_004 | CMF_OBV_Position | 15% | 1.102 | 21.6% | -26.9% | 5 |
| strat_005 | ADX_Position_Sharpe | 15% | 1.030 | 20.4% | -24.0% | 3 |

**组合预期表现**：
- 加权平均Sharpe: ~1.10
- 加权平均年化收益: ~21.5%
- 加权平均回撤: ~-21.5%

### 1.2 因子结构多样化

- **RSI族** (50%权重): RSI_14, MAX_DD_60D为核心，配合VOL_RATIO/VORTEX协同
- **VOL族** (20%权重): VOL_RATIO_60D主导，PRICE_POSITION/SHARPE_RATIO辅助
- **ADX/CMF/VORTEX族** (30%权重): 趋势+资金流因子，防止与RSI同质化

---

## 二、执行参数

### 2.1 调仓设置
```json
{
  "rebalance_frequency": 8,  // 每8天调仓一次
  "position_size": 5,         // 每个策略持有5只ETF
  "execution_time": "09:35",  // 开盘后5分钟执行
  "execution_price": "VWAP_30min"  // 使用前30分钟VWAP
}
```

### 2.2 成本参数
```json
{
  "commission": 0.0015,  // 单边0.15%
  "slippage": 0.001,     // 0.1%滑点
  "min_order_size": 100  // 最小交易单位100股
}
```

---

## 三、风险控制规则

### 3.1 策略级风控

**触发条件**（满足任一）：
1. 60天滚动回撤 < -30%
2. 60天滚动Sharpe < 0.30
3. 60天滚动胜率 < 45%

**执行动作**：
- 降低该策略权重至50%
- 剩余权重按比例分配给其他策略
- 每周复核一次，连续4周正常后恢复权重

**代码示例**：
```python
def check_strategy_health(strategy_id, window=60):
    recent_dd = get_rolling_drawdown(strategy_id, window)
    recent_sharpe = get_rolling_sharpe(strategy_id, window)
    recent_winrate = get_rolling_winrate(strategy_id, window)
    
    if recent_dd < -0.30 or recent_sharpe < 0.30 or recent_winrate < 0.45:
        reduce_weight(strategy_id, factor=0.5)
        send_alert(f"Strategy {strategy_id} breached risk threshold")
```

### 3.2 组合级风控

| 指标 | 阈值 | 动作 |
|------|------|------|
| 组合总回撤 | < -28% | 全组合降权50%，增加现金仓位 |
| 单一持仓权重 | > 12% | 强制平仓至10%以下 |
| 行业集中度 | > 40% | 限制同行业新增头寸 |
| 权重漂移 | > 5% | 触发再平衡 |

### 3.3 紧急止损

**条件**（满足任一）：
1. 连续10个交易日亏损
2. 单日亏损 > 5%

**动作**：
- 立即清仓所有持仓
- 暂停所有策略交易
- 人工审核后决定是否恢复

---

## 四、监控与报告

### 4.1 日度监控

**每日盘后更新（17:00前）**：
```yaml
metrics:
  - 每个策略的PnL、持仓、换手率
  - 组合总回撤、Sharpe（60天滚动）
  - 预警触发检查
  
alerts:
  - 策略回撤 < -25%
  - 策略60天Sharpe < 0.35
  - 策略60天胜率 < 46%
  - 组合回撤 < -25%
```

**Dashboard指标**：
- 累计净值曲线（5条策略 + 1条组合）
- 每日收益柱状图
- 回撤水下图
- 持仓热力图（按行业/因子）

### 4.2 周度报告

**每周五下班前发送**：
```
1. 本周表现总结
   - 各策略Sharpe、收益、回撤
   - 最佳/最差策略及原因
   
2. 风险检查
   - 是否触发预警
   - 权重漂移情况
   - 行业集中度
   
3. 交易统计
   - 调仓次数、换手率
   - 成交均价 vs VWAP偏离
   - 交易成本占比
   
4. 因子有效性
   - IC衰减监控
   - 因子相关性变化
```

### 4.3 月度复盘

**每月第一个工作日**：
```
1. 完整绩效评估
   - 各策略vs基准（沪深300、中证500）
   - 夏普/卡玛/索提诺完整指标
   - 收益归因分析
   
2. 因子重要性
   - Top5因子贡献度
   - 失效因子识别
   
3. 策略调整建议
   - 是否需要剔除/替换策略
   - 权重再分配方案
   - WFO重新扫描计划
```

---

## 五、部署清单

### 5.1 数据准备
- [ ] ETF日线数据接入（43只）
- [ ] 因子计算模块测试（18个因子）
- [ ] 历史数据完整性检查（2020-01至今）

### 5.2 代码部署
- [ ] 策略配置JSON上传至生产环境
- [ ] 回测验证脚本部署
- [ ] 风控模块单元测试
- [ ] 监控Dashboard部署

### 5.3 权限与审批
- [ ] 交易账户开通（模拟盘/实盘）
- [ ] 风控参数审批签字
- [ ] 紧急止损流程确认
- [ ] 报警通知组设置

### 5.4 测试阶段
- [ ] 模拟盘运行7天（2025-11-11至11-17）
- [ ] 对比回测结果，NAV偏差<1%
- [ ] 压力测试（历史极端行情回放）
- [ ] 故障演练（数据缺失、API超时等）

### 5.5 正式上线
- [ ] 2025-11-18开始小资金实盘（10万起）
- [ ] 运行30天无重大问题后扩大资金
- [ ] 每月15日重新评估策略权重

---

## 六、下一步优化（可选）

### 6.1 短期（1-2周内）
1. **单因子WFO补充**：运行`combo_sizes=[1]`，生成单因子风险清单
2. **校准器A/B测试**：对比IC排序 vs 校准器排序，选择最优方法
3. **相关性分析**：计算5个策略间的rolling correlation，调整权重降低共线性

### 6.2 中期（1个月内）
4. **鲁棒性测试**：变化OOS长度（30/60/90天）和步长（30/60天），验证稳定性
5. **白名单机制**：强制要求组合包含RSI_14或MAX_DD_60D，测试改善效果
6. **行业中性化**：引入行业约束，防止单一板块暴露过高

### 6.3 长期（3个月+）
7. **机器学习增强**：用GBDT/XGBoost预测因子权重，替代IC线性加权
8. **高频信号融合**：在日线基础上融合30分钟/小时线因子
9. **跨资产扩展**：将框架推广至A股/港股/商品ETF

---

## 七、联系方式

**策略负责人**: [姓名]  
**风控负责人**: [姓名]  
**技术负责人**: [姓名]  
**紧急联系**: [手机]  

**Slack频道**: `#etf-rotation-prod`  
**Git Repo**: `https://github.com/xxx/etf-rotation-optimized`  
**文档路径**: `/production/DEPLOYMENT_GUIDE.md`  

---

**最后更新**: 2025-11-10  
**下次审核**: 2025-12-10
