# Memory 目录方法论：项目经验知识库模板

> 本文档是一个可复用的模板，用于在任何项目中建立类似的知识库系统。
> 基于 ETF 轮动策略项目的实践经验总结。

---

## 一、核心理念

### 1.1 为什么要建立 Memory？

| 场景 | 没有 Memory | 有 Memory |
|------|------------|-----------|
| 新成员加入 | 口头传达，信息衰减 | 文档化，可检索 |
| 重复犯错 | "我记得修过这个" | 有记录，可追溯 |
| AI 助手切换 | 每次重新踩坑 | 继承历史教训 |
| 决策背景丢失 | "当时为什么这么做？" | 决策记录可查 |

**核心价值：把血泪教训变成可执行的规则，避免重复付学费。**

### 1.2 什么时候需要建立？

- 项目复杂度：3+ 模块 / 多阶段管线 / 有状态系统
- 团队规模：2+ 人或频繁切换 AI 助手
- 踩坑次数：同一个问题出现 2 次以上
- 项目周期：长周期项目（1 个月+）

---

## 二、目录结构

```
memory/
├── README.md           # 索引 + 使用指南（必需）
├── rules.md            # 硬性规则（必需）
├── YYYY-MM_topic.md    # 按日期命名的事件记录
├── reference.md        # 参考手册（可选）
└── ARCHIVE/            # 归档（可选）
```

### 2.1 README.md 结构

```markdown
# Memory — 项目经验知识库

> 本目录存储项目中的重要复盘和教训，供所有 AI 助手和开发者参考。

## 文档索引

| 文件 | 日期 | 类型 | 简介 |
|------|------|------|------|
| [rules.md](./rules.md) | YYYY-MM | 规则 | 核心规则（N条） |
| [YYYY-MM_xxx.md](./YYYY-MM_xxx.md) | YYYY-MM | 教训 | 事件描述 |

## 如何使用

### 新 AI 助手 / 开发者加入时
1. 必读：阅读本目录下所有文档
2. 理解：了解历史教训
3. 遵守：按规则执行

### 添加新教训时
1. 创建 `YYYY-MM_topic.md`
2. 更新本索引
3. 包含：背景、问题、教训、检查清单

## 文档模板

[附模板代码]
```

### 2.2 rules.md 结构

```markdown
# Rules: 项目硬性规则

## Rule 1: [规则名称]

[问题描述]

```
[具体场景]
  → 第1步：做什么
  → 第2步：做什么
  → 红旗信号：...
```

**检查清单**：
- [ ] 检查项1
- [ ] 检查项2
```

---

## 三、文档分类

| 类型 | 命名 | 用途 | 生命周期 |
|------|------|------|---------|
| **规则** | `rules.md` | 硬性约束，必须遵守 | 长期维护 |
| **教训** | `YYYY-MM_topic.md` | 单次事件复盘 | 归档但保留 |
| **参考** | `reference.md` | 常用信息索引 | 随项目更新 |
| **元教训** | `YYYY-MM_meta_xxx.md` | 模式识别，跨教训抽象 | 长期维护 |

---

## 四、写作规范

### 4.1 教训文档模板

```markdown
# [标题]

> 日期: YYYY-MM-DD
> 类型: 教训 / 最佳实践 / 决策记录
> 关联规则: Rule X, Rule Y

## 事件

[客观描述发生了什么，不带评价]

## 问题/错误

1. [具体问题1]
2. [具体问题2]

## 根因分析

[为什么会出现这个问题]

## 影响

[这个问题造成了什么后果]

## 教训/修复

- [ ] 检查项1
- [ ] 检查项2

## 相关文件

- `path/to/file1` — 说明
- `path/to/file2` — 说明
```

### 4.2 Rule 写作规范

每条 Rule 必须包含：

1. **触发条件**：什么时候需要参考这条 Rule
2. **具体步骤**：做什么，按什么顺序
3. **红旗信号**：什么情况说明出问题了
4. **检查清单**：可勾选的具体项目

```markdown
## Rule N: [规则名称]

**触发条件**：[什么时候用]

**步骤**：
```
第1步：[做什么]
  → [预期结果]
  → 红旗：[异常信号]

第2步：[做什么]
  ...
```

**检查清单**：
- [ ] [具体项目1]
- [ ] [具体项目2]

**反面案例**：
- ❌ [错误做法]

**正面案例**：
- ✅ [正确做法]
```

### 4.3 元教训模板

当发现 3 次以上的相似问题时，抽象为元教训：

```markdown
# META-LESSON: [模式名称]

> 关联规则: Rule X, Y, Z

## 模式识别

| 日期 | 表现 | 根因 | Rule |
|------|------|------|------|
| XX | ... | ... | X |
| YY | ... | ... | Y |

**共同根因**：[抽象后的根本原因]

## 抽象模式

```
[用图示表示通用故障链]
```

## 防御原则

1. [原则1]
2. [原则2]

## 检查清单

- [ ] [通用检查项]
```

---

## 五、使用流程

### 5.1 新 AI 助手接入流程

```
1. 阅读 memory/README.md（索引）
2. 阅读 memory/rules.md（硬性规则）
3. 扫读所有 YYYY-MM_*.md（历史教训）
4. 开始工作，遇到问题时先检索 memory/
```

### 5.2 问题发生后的记录流程

```
1. 问题解决后，立即创建 YYYY-MM_topic.md
2. 按 4.1 模板填写
3. 如果是新问题类型：
   a. 在 rules.md 添加新 Rule
   b. 或发现是第 3 次相似问题 → 创建元教训
4. 更新 README.md 索引
```

### 5.3 规则演进流程

```
Rule 不是静态的：
- 新问题 → 添加新 Rule
- 旧 Rule 不适用 → 标记 DEPRECATED 并说明原因
- 多个 Rule 相关 → 抽象为元教训
```

---

## 六、维护机制

### 6.1 定期审计

| 频率 | 动作 |
|------|------|
| 每周 | 检查是否有未记录的问题 |
| 每月 | 审计 Rule 可执行性（是否过时） |
| 每季度 | 整理元教训，归档旧教训 |

### 6.2 质量标准

好的 Rule/教训 必须：
- ✅ 可执行（有具体检查清单）
- ✅ 可检索（关键词明确）
- ✅ 可追溯（有关联文件引用）
- ✅ 有红旗信号（知道什么时候触发）

避免：
- ❌ 模糊描述（"要注意代码质量"）
- ❌ 无检查清单（只有原则没有操作）
- ❌ 无关联文件（无法追溯代码）

---

## 七、常见模式库

### 7.1 管线类项目

```
memory/
├── rules.md          # 含：数据透传、阶段对齐、gap 监控
├── YYYY-MM_gap_xxx   # 各阶段 gap 异常复盘
├── YYYY-MM_meta_xxx  # 信息瓶颈元教训
└── reference.md      # 阶段参数对齐表
```

### 7.2 API/服务类项目

```
memory/
├── rules.md          # 含：版本兼容、错误处理、日志规范
├── YYYY-MM_xxx       # 各类故障复盘
└── reference.md      # API 变更记录
```

### 7.3 研究类项目

```
memory/
├── rules.md          # 含：实验可复现、假设验证、结论审查
├── YYYY-MM_xxx       # 错误结论复盘
└── reference.md      # 实验参数记录
```

---

## 八、快速启动清单

新项目建立 Memory 系统：

```
□ 1. 创建 memory/ 目录
□ 2. 创建 README.md（用 2.1 模板）
□ 3. 创建 rules.md（初始可以是空的，随项目演进）
□ 4. 项目 CLAUDE.md / README 中添加引用：
     "新 AI 助手加入时，必须先阅读 memory/ 目录"
□ 5. 第一次踩坑后，按 4.1 模板记录
□ 6. 第三次相似问题后，抽象为 Rule
```

---

## 九、与 CLAUDE.md 的关系

| 文档 | 用途 | 受众 |
|------|------|------|
| `CLAUDE.md` | 项目概览、命令、约定 | 首次接触项目 |
| `memory/rules.md` | 硬性规则、检查清单 | 执行具体任务前 |
| `memory/YYYY-MM_*.md` | 历史教训、决策背景 | 遇到问题时 |

**关系**：CLAUDE.md 是"地图"，memory/ 是"路标和护栏"。

---

## 十、附录：本项目 rules.md 的 26 条规则摘要

供参考，展示规则颗粒度：

| 规则 | 主题 |
|------|------|
| 1-10 | 策略验证诊断（拆分数据、四关验证、门槛校准） |
| 11-13 | 代码交付（三层验证、测试覆盖） |
| 14-18 | 管线对齐（中台化、静默丢弃、生产脚本优先） |
| 19-24 | 参数传播（hysteresis、metadata、IC-sign） |
| 25-26 | 封板流程（VEC-BT gap、修完再封） |

**关键特征**：每条 Rule 都来自具体事件，有检查清单，有反面案例。

---

*模板版本*: 1.0  
*来源*: ETF 轮动策略项目 memory/ 目录实践  
*创建*: 2026-02-16
