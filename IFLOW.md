# iFlow CLI - æ·±åº¦é‡åŒ–äº¤æ˜“å¼€å‘ç¯å¢ƒ

## ğŸ¯ é¡¹ç›®æ¦‚è§ˆ

**æ·±åº¦é‡åŒ–0927** æ˜¯ä¸€ä¸ªä¸“ä¸šçº§é‡åŒ–äº¤æ˜“å¼€å‘ç¯å¢ƒï¼Œæä¾›ç»Ÿä¸€çš„å› å­è®¡ç®—å¼•æ“ï¼Œæ”¯æŒå¤šå¸‚åœºç®—æ³•åŒ–äº¤æ˜“ç ”ç©¶ã€‚ç³»ç»Ÿæ ¸å¿ƒæ˜¯**FactorEngine**æ¶æ„ï¼Œç¡®ä¿ç ”ç©¶ã€å›æµ‹å’Œç”Ÿäº§ç¯å¢ƒçš„100%ä¸€è‡´æ€§ã€‚

**æ ¸å¿ƒç†å¿µ**ï¼šLinus Torvaldså·¥ç¨‹åŸåˆ™ - æ¶ˆé™¤ç‰¹æ®Šæ¡ˆä¾‹ï¼Œæä¾›å®ç”¨è§£å†³æ–¹æ¡ˆï¼Œç¡®ä¿ä»£ç åœ¨å®é™…å¸‚åœºä¸­å¯é è¿è¡Œã€‚

## ğŸš€ æ ¸å¿ƒç³»ç»Ÿç»„ä»¶

### 1. **FactorEngine ç»Ÿä¸€æ¶æ„**
- âœ… **APIæ¥å£**: `factor_system/factor_engine/api.py` - å•ä¸€å…¥å£ç‚¹
- âœ… **æ ¸å¿ƒå¼•æ“**: æ”¯æŒåŒé‡ç¼“å­˜ï¼Œé«˜æ€§èƒ½å› å­è®¡ç®—
- âœ… **å› å­æ³¨å†Œè¡¨**: 154ä¸ªæŠ€æœ¯æŒ‡æ ‡ + 15ä¸ªèµ„é‡‘æµå› å­ + 206ä¸ªETFæ¨ªæˆªé¢å› å­
- âœ… **æ•°æ®æä¾›è€…**: Parquetã€CSVã€åˆ†é’Ÿæ•°æ®ã€èµ„é‡‘æµæ•°æ®

### 2. **å¤šå¸‚åœºæ”¯æŒ**
- âœ… **æ¸¯è‚¡å¸‚åœº**: 276+è‚¡ç¥¨ï¼Œ1åˆ†é’Ÿåˆ°æœˆçº¿æ•°æ®
- âœ… **Aè‚¡å¸‚åœº**: èµ„é‡‘æµå› å­ç³»ç»Ÿï¼ŒT+1æ‰§è¡Œçº¦æŸ
- âœ… **ETFå¸‚åœº**: 19ä¸ªæ ¸å¿ƒETFï¼Œ2å¹´å†å²æ•°æ®ï¼Œæ¨ªæˆªé¢å› å­åˆ†æ

### 3. **å› å­è®¡ç®—ç³»ç»Ÿ**
- âœ… **154ä¸ªæŠ€æœ¯æŒ‡æ ‡**: 36æ ¸å¿ƒ + 118å¢å¼ºæŒ‡æ ‡
- âœ… **15ä¸ªèµ„é‡‘æµå› å­**: 8æ ¸å¿ƒ + 4å¢å¼º + 3çº¦æŸå› å­
- âœ… **206ä¸ªETFæ¨ªæˆªé¢å› å­**: 20ä¼ ç»Ÿ + 174åŠ¨æ€å› å­
- âœ… **å¤šæ—¶é—´æ¡†æ¶**: 1minåˆ°monthlyï¼Œè‡ªåŠ¨é‡é‡‡æ ·
- âœ… **å‘é‡åŒ–å®ç°**: >95%å‘é‡åŒ–ç‡

### 4. **ä¸“ä¸šå› å­ç­›é€‰**
- âœ… **5ç»´åº¦è¯„ä¼°**: é¢„æµ‹åŠ›ã€ç¨³å®šæ€§ã€ç‹¬ç«‹æ€§ã€å®ç”¨æ€§ã€é€‚åº”æ€§
- âœ… **ç»Ÿè®¡ä¸¥è°¨æ€§**: Benjamini-Hochberg FDRæ ¡æ­£ï¼ŒVIFåˆ†æ
- âœ… **æˆæœ¬å»ºæ¨¡**: æ¸¯è‚¡ä½£é‡‘ã€å°èŠ±ç¨ã€æ»‘ç‚¹æ¨¡å‹

### 5. **è´¨é‡ä¿éšœä½“ç³»**
- âœ… **ç»Ÿä¸€è´¨é‡æ£€æŸ¥**: pyscn + Vulture + é‡åŒ–å®‰å…¨æ£€æŸ¥
- âœ… **Gitè‡ªåŠ¨åŒ–é’©å­**: pre-commitåŸºç¡€æ£€æŸ¥ + pre-pushå…¨é¢æ£€æŸ¥
- âœ… **æ€§èƒ½åŸºå‡†**: 300-800+ å› å­/ç§’è®¡ç®—é€Ÿåº¦
- âœ… **æ¶æ„åˆè§„**: 73%æ¶æ„åˆè§„ç‡ï¼Œç›®æ ‡>90%

## ğŸ“Š æŠ€æœ¯ç‰¹æ€§

- **å‘é‡åŒ–è®¡ç®—**: 100%é‡‡ç”¨Pandas/NumPyå‘é‡åŒ–ï¼Œæ— å¾ªç¯
- **ç»Ÿä¸€å£å¾„**: æ‰€æœ‰å æ¯”å› å­åˆ†æ¯é”æ­»ä¸º`turnover_amount`
- **æ— å‰è§†åå·®**: ä¸¥æ ¼éµå¾ª14:30ä¿¡å·å†»ç»“ï¼ŒT+1æ‰§è¡Œ
- **å¯äº¤æ˜“æ€§çº¦æŸ**: `tradability_mask`æœ‰æ•ˆè¿‡æ»¤ä¸å¯äº¤æ˜“æ ·æœ¬
- **è‡ªåŠ¨åŒ–æµ‹è¯•**: è¦†ç›–æ•°æ®å£å¾„ã€å› å­è®¡ç®—ã€T+1æ‰§è¡Œç­‰å…³é”®ç¯èŠ‚
- **å¤šæ—¶é—´æ¡†æ¶**: æ”¯æŒ 1min/5min/15min/30min/60min/120min/240min/daily/weekly/monthly

## ğŸ› ï¸ å¼€å‘ç¯å¢ƒ

### ç¯å¢ƒå®‰è£…
```bash
# ä½¿ç”¨uvç°ä»£åŒ…ç®¡ç†å™¨
uv sync

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source .venv/bin/activate

# å¼€å‘å®‰è£…ï¼ˆåŒ…å«æ‰€æœ‰å·¥å…·ï¼‰
uv sync --group all
```

### ä»£ç è´¨é‡å·¥å…·
```bash
# ç»Ÿä¸€ä»£ç è´¨é‡æ£€æŸ¥ (æ¨è)
bash scripts/unified_quality_check.sh

# ä»£ç æ ¼å¼åŒ–
black factor_system/
isort factor_system/

# ç±»å‹æ£€æŸ¥
mypy factor_system/

# è¿è¡Œpre-commité’©å­
pre-commit run --all-files
```

### æ€§èƒ½åŸºå‡†
- **å› å­è®¡ç®—é€Ÿåº¦**: 300-800+ å› å­/ç§’
- **å†…å­˜æ•ˆç‡**: >70%åˆ©ç”¨ç‡ï¼ˆPolarsä¼˜åŒ–ï¼‰
- **ç¼“å­˜å‘½ä¸­ç‡**: >90%ï¼ˆæ™ºèƒ½é¢„çƒ­ï¼‰

## ğŸ¯ å¿«é€Ÿå¼€å§‹

### 1. å› å­è®¡ç®—ï¼ˆæ¨èæ–¹å¼ï¼‰
```python
from factor_system.factor_engine import api
from datetime import datetime

# è®¡ç®—æŠ€æœ¯æŒ‡æ ‡
factors = api.calculate_factors(
    factor_ids=["RSI14", "MACD", "STOCH"],
    symbols=["0700.HK", "0005.HK"],
    timeframe="15min",
    start_date=datetime(2025, 9, 1),
    end_date=datetime(2025, 9, 30)
)

# è®¡ç®—èµ„é‡‘æµå› å­ï¼ˆAè‚¡ï¼‰
money_flow_factors = api.calculate_factors(
    factor_ids=["MainNetInflow_Rate", "LargeOrder_Ratio"],
    symbols=["000001.SZ", "600036.SH"],
    timeframe="daily",
    start_date=datetime(2025, 9, 1),
    end_date=datetime(2025, 9, 30)
)

# è®¡ç®—ETFæ¨ªæˆªé¢å› å­ï¼ˆ206ä¸ªå› å­ï¼‰
from factor_system.factor_engine.factors.etf_cross_section import create_etf_cross_section_manager
etf_manager = create_etf_cross_section_manager()
etf_cross_section = etf_manager.calculate_factors(
    symbols=["510300.SH", "159919.SZ", "512100.SH"],
    timeframe="daily",
    start_date=datetime(2025, 9, 1),
    end_date=datetime(2025, 9, 30)
)
```

### 2. æ‰¹é‡å› å­ç”Ÿæˆ
```bash
# æ¸¯è‚¡å•è‚¡ç¥¨å› å­ç”Ÿæˆ
cd factor_system/factor_generation
python run_single_stock.py 0700.HK

# Aè‚¡å› å­ç”Ÿæˆ
python a_shares_strategy/generate_a_share_factors.py 600036.SH --timeframe 5min

# ETFæ•°æ®å¤„ç†
python etf_download_manager/download_etf_final.py
```

### 3. å› å­ç­›é€‰
```bash
# ä¸“ä¸š5ç»´åº¦å› å­ç­›é€‰
cd factor_system/factor_screening
python professional_factor_screener.py --symbol 0700.HK --timeframe 60min

# ETFæ¨ªæˆªé¢å› å­ç­›é€‰
python etf_factor_engine_production/scripts/legacy_production_full_cross_section.py
```

### 4. ç³»ç»ŸéªŒè¯
```bash
# è¿è¡Œæµ‹è¯•å¥—ä»¶
pytest -v

# FactorEngineä¸€è‡´æ€§éªŒè¯
python tests/test_factor_engine_consistency.py

# ETFæ¨ªæˆªé¢ç³»ç»Ÿå†’çƒŸæµ‹è¯•
python scripts/comprehensive_smoke_test.py

# è·¯å¾„ç®¡ç†ç³»ç»ŸéªŒè¯
python -c "from factor_system.utils import get_project_root; print('âœ… ç³»ç»Ÿæ­£å¸¸')"
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
æ·±åº¦é‡åŒ–0927/
â”œâ”€â”€ factor_system/                # æ ¸å¿ƒå› å­ç³»ç»Ÿ
â”‚   â”œâ”€â”€ factor_engine/           # ç»Ÿä¸€å› å­è®¡ç®—å¼•æ“
â”‚   â”‚   â””â”€â”€ factors/etf_cross_section/  # ETFæ¨ªæˆªé¢å› å­ç³»ç»Ÿ (206å› å­)
â”‚   â”œâ”€â”€ factor_generation/       # æ‰¹é‡å› å­ç”Ÿæˆ
â”‚   â”œâ”€â”€ factor_screening/        # ä¸“ä¸šå› å­ç­›é€‰
â”‚   â””â”€â”€ utils/                   # è·¯å¾„ç®¡ç†å’Œå·¥å…·
â”œâ”€â”€ a_shares_strategy/           # Aè‚¡ç­–ç•¥æ¡†æ¶
â”œâ”€â”€ etf_download_manager/        # ETFæ•°æ®ç®¡ç†
â”œâ”€â”€ etf_factor_engine_production/ # ETFå› å­å¼•æ“ç”Ÿäº§ç¯å¢ƒ
â”œâ”€â”€ hk_midfreq/                  # æ¸¯è‚¡ä¸­é¢‘ç­–ç•¥
â”œâ”€â”€ examples/                    # ä½¿ç”¨ç¤ºä¾‹
â”œâ”€â”€ scripts/                     # å·¥å…·è„šæœ¬
â”‚   â”œâ”€â”€ unified_quality_check.sh # ç»Ÿä¸€è´¨é‡æ£€æŸ¥
â”‚   â””â”€â”€ comprehensive_smoke_test.py # ETFç³»ç»Ÿæµ‹è¯•
â”œâ”€â”€ tests/                       # æµ‹è¯•å¥—ä»¶
â”œâ”€â”€ raw/                         # åŸå§‹æ•°æ®å­˜å‚¨
â””â”€â”€ docs/                        # è¯¦ç»†æ–‡æ¡£
```

## ğŸ”§ æ ¸å¿ƒé…ç½®æ–‡ä»¶

### pyproject.toml
- **Pythonç‰ˆæœ¬**: â‰¥3.11
- **æ ¸å¿ƒä¾èµ–**: vectorbt, pandas, numpy, ta-lib, polars
- **å¼€å‘å·¥å…·**: pytest, black, mypy, pre-commit
- **è´¨é‡å·¥å…·**: pyscnâ‰¥1.1.1, vultureâ‰¥2.14

### Makefile
```bash
make help     # æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
make install  # å®‰è£…å¼€å‘ä¾èµ–
make format   # æ ¼å¼åŒ–ä»£ç 
make lint     # è¿è¡Œä»£ç æ£€æŸ¥
make test     # è¿è¡Œæµ‹è¯•
make check    # è¿è¡Œæ‰€æœ‰è´¨é‡æ£€æŸ¥
```

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### è´¨é‡è¯„åˆ†ä½“ç³»
- **å½“å‰å¥åº·è¯„åˆ†**: 85/100 (Açº§)
- **å¤æ‚åº¦è¯„åˆ†**: 70/100 (å¹³å‡9.45ï¼Œç›®æ ‡â‰¤8)
- **ä»£ç é‡å¤**: 6.4% (ç›®æ ‡<2%)
- **æ¶æ„åˆè§„**: 73% (ç›®æ ‡>90%)

### è®¡ç®—æ€§èƒ½
- **å°è§„æ¨¡åŒ–** (500Ã—20å› å­): 831+ å› å­/ç§’
- **ä¸­ç­‰è§„æ¨¡** (1000Ã—50å› å­): 864+ å› å­/ç§’
- **å¤§è§„æ¨¡** (2000Ã—100å› å­): 686+ å› å­/ç§’
- **è¶…å¤§è§„æ¨¡** (5000Ã—200å› å­): 370+ å› å­/ç§’

## ğŸ›¡ï¸ å®‰å…¨ä¸åˆè§„

### æ ¸å¿ƒå®‰å…¨çº¢çº¿
- **æœªæ¥å‡½æ•°æ£€æµ‹**: ä¸¥ç¦ä½¿ç”¨æœªæ¥æ•°æ®ï¼Œç¡®ä¿å›æµ‹æœ‰æ•ˆæ€§
- **T+1æ—¶é—´å®‰å…¨**: ä¸¥æ ¼æ‰§è¡Œäº¤æ˜“æ—¥å»¶è¿Ÿï¼Œé˜²æ­¢æ—¶é—´æ³„éœ²
- **å› å­æ¸…å•åˆè§„**: FactorEngineå¿…é¡»ä¸¥æ ¼éµå¾ªå®˜æ–¹å› å­æ¸…å•

### Gitè‡ªåŠ¨åŒ–è´¨é‡é—¨
- **Pre-commitæ£€æŸ¥**: åŸºç¡€å®‰å…¨æ£€æŸ¥å’Œè´¨é‡éªŒè¯
- **Pre-pushæ£€æŸ¥**: å®Œæ•´è´¨é‡åˆ†æå¥—ä»¶ï¼ˆpyscn + Vulture + é‡åŒ–æ£€æŸ¥ï¼‰

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **æ ¸å¿ƒæŒ‡å—**: `CLAUDE.md` - å®Œæ•´é¡¹ç›®æŒ‡å¯¼å’ŒæŠ€æœ¯ç»†èŠ‚
- **Aè‚¡ç³»ç»Ÿ**: `README_A_SHARES.md` - Aè‚¡ä¸“é—¨è¯´æ˜
- **å› å­é›†**: `README_FACTOR_SETS.md` - å› å­é›†ç®¡ç†
- **ETFæ¨ªæˆªé¢**: `etf_factor_engine_production/` - ETFå› å­ç³»ç»Ÿæ–‡æ¡£
- **è´¨é‡æ£€æŸ¥**: `scripts/unified_quality_check.sh` - è´¨é‡æ£€æŸ¥å·¥å…·

## ğŸ¯ é€‚ç”¨åœºæ™¯

- **é‡åŒ–ç ”ç©¶**: 154ä¸ªæŠ€æœ¯æŒ‡æ ‡ + 15ä¸ªèµ„é‡‘æµå› å­ + 206ä¸ªETFæ¨ªæˆªé¢å› å­
- **ç­–ç•¥å¼€å‘**: å¤šå¸‚åœºã€å¤šæ—¶é—´æ¡†æ¶æ”¯æŒ
- **å› å­ç­›é€‰**: 5ç»´åº¦ä¸“ä¸šè¯„ä¼°ä½“ç³»
- **å›æµ‹åˆ†æ**: ä¸VectorBTæ·±åº¦é›†æˆ
- **ç”Ÿäº§éƒ¨ç½²**: ç»Ÿä¸€æ¶æ„ç¡®ä¿ä¸€è‡´æ€§
- **è´¨é‡ä¿éšœ**: ä¸“ä¸šçº§ä»£ç è´¨é‡æ£€æŸ¥ä½“ç³»

---

**ç»´æŠ¤è€…**: é‡åŒ–å·¥ç¨‹å›¢é˜Ÿ | **æ›´æ–°**: 2025-10-17 | **ç‰ˆæœ¬**: v3.1

**æ ¸å¿ƒä¼˜åŠ¿**: ç»Ÿä¸€æ¶æ„ + å¤šå¸‚åœºæ”¯æŒ + ä¸“ä¸šè´¨é‡ä¿éšœ + ç”Ÿäº§çº§å¯é æ€§