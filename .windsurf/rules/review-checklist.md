---
trigger: manual
description:
globs:
---

# 代码审查清单
# Quantitative Engineering Code Review Checklist

## 🔧 技术质量审查

### 代码结构
- [ ] **单一职责原则**: 每个函数/类职责单一明确
- [ ] **函数长度**: 函数不超过50行
- [ ] **复杂度控制**: 圈复杂度 < 10
- [ ] **命名规范**: 使用描述性命名，无缩写（除广泛接受的）
- [ ] **模块化设计**: 高内聚，低耦合

### 类型安全
- [ ] **类型注解**: 100% 公共接口类型注解覆盖
- [ ] **类型检查**: mypy 检查通过，无类型错误
- [ ] **输入验证**: 所有外部输入参数类型和范围验证
- [ ] **返回值一致性**: 函数返回值类型一致

### 错误处理
- [ ] **异常处理**: 使用具体异常类型，避免裸 except
- [ ] **资源清理**: 文件、数据库连接等资源正确释放
- [ ] **优雅降级**: 错误情况下系统能够优雅降级
- [ ] **日志记录**: 关键操作和错误有适当日志记录

## 📊 量化特定审查

### 偏差防护
- [ ] **无未来函数**: 严格检查时间序列对齐，无未来数据泄露
- [ ] **幸存者偏差**: 包含退市公司历史数据
- [ ] **数据窥探防护**: 样本外验证，避免过度拟合
- [ ] **选择偏差**: 随机抽样，无选择性删除

### 统计严谨性
- [ ] **多重比较校正**: Benjamini-Hochberg FDR校正应用
- [ ] **样本量充足**: 最小样本量要求满足
- [ ] **统计方法适当**: 统计方法选择合理
- [ ] **置信区间**: 重要指标提供置信区间
- [ ] **效应大小**: 关注实际经济显著性

### 数值稳定性
- [ ] **除零保护**: 所有可能除零操作都有保护
- [ ] **数值溢出**: 大数值计算有溢出检查
- [ ] **精度控制**: 浮点数精度损失最小化
- [ ] **边界条件**: 极值和异常值处理正确

### 性能标准
- [ ] **向量化计算**: 使用 NumPy/VectorBT 操作
- [ ] **内存效率**: 内存使用符合规范 (<70% 利用率)
- [ ] **计算速度**: 关键路径 <1ms
- [ ] **缓存机制**: 重复计算结果缓存
- [ ] **批量处理**: 避免逐个处理大数据集

## 🔍 量化算法审查

### 因子计算
- [ ] **算法正确性**: 数学公式实现准确无误
- [ ] **计算逻辑**: 因子计算逻辑清晰正确
- [ ] **参数合理性**: 窗口长度、周期等参数设置合理
- [ ] **数据预处理**: 输入数据预处理完整
- [ ] **结果校验**: 因子结果与预期一致

### 技术指标
- [ ] **TA-Lib 集成**: 正确使用 TA-Lib 库函数
- [ ] **自定义指标**: 自定义指标数学计算正确
- [ ] **指标有效性**: 指标在市场中具有预测能力
- [ ] **参数优化**: 指标参数经过合理优化
- [ ] **性能优化**: 指标计算性能满足要求

### 回测系统
- [ ] **交易执行模拟**: 交易执行机制真实可靠
- [ ] **成本计算**: 包含手续费、滑点、市场冲击
- [ ] **风险控制**: 止损、仓位管理机制完善
- [ ] **时间序列一致性**: 回测时间序列准确无偏
- [ ] **结果验证**: 回测结果与理论预期一致

## 📋 业务逻辑审查

### 市场适应性
- [ ] **多市场支持**: A股、港股、美股市场适配
- [ ] **不同时间框架**: 分钟级到日线级数据处理
- [ ] **市场异常处理**: 市场异常、停牌等情况处理
- [ ] **数据源可靠性**: 数据源稳定可靠，更新及时
- [ ] **实时性要求**: 实时数据处理延迟可接受

### 交易逻辑
- [ ] **信号生成**: 买卖信号生成逻辑清晰
- [ ] **仓位管理**: 仓位计算和调整策略合理
- [ ] **止损止盈**: 止损止盈机制完善
- [ ] **资金管理**: 资金分配和风险管理策略
- [ ] **交易成本**: 交易成本影响考虑充分

## 🔄 代码质量改进

### 代码优化
- [ ] **算法优化**: 算法时间和空间复杂度优化
- [ ] **数据结构优化**: 使用合适的数据结构
- [ ] **内存优化**: 内存使用效率和垃圾回收优化
- [ ] **并行化**: 适合的并行化实现
- [ ] **缓存策略**: 合理的缓存策略设计

### 测试覆盖
- [ ] **单元测试**: 核心功能单元测试覆盖
- [ ] **集成测试**: 模块间集成测试完整
- [ ] **回归测试**: 重要功能回归测试覆盖
- [ ] **性能测试**: 关键路径性能测试
- [ ] **边界测试**: 边界条件和异常情况测试

### 文档完整性
- [ ] **API文档**: 公共接口文档完整准确
- [ ] **算法文档**: 核心算法实现原理文档
- [ ] **配置文档**: 配置参数说明文档
- [ ] **用户手册**: 使用指南和示例文档
- [ ] **更新日志**: 版本变更记录完整

## ✅ 审查结论

### 通过标准
- **技术质量**: 代码结构良好，类型安全，错误处理完善
- **量化严谨**: 统计方法正确，偏差控制严格，数值稳定
- **性能达标**: 性能指标满足要求，优化合理
- **业务合理**: 业务逻辑清晰，市场适应性良好
- **质量保证**: 测试覆盖充分，文档完整

### 需要改进
- **问题清单**: 具体问题和改进建议
- **优先级**: 问题修复优先级
- **时间计划**: 改进实施时间表
- **负责人**: 问题修复责任人
- **验证方法**: 改进效果验证方法

## 📝 审查报告

### 审查总结
- **审查范围**: 审查文件和功能模块清单
- **主要发现**: 重要问题和亮点总结
- **风险评估**: 潜在风险和影响评估
- **改进建议**: 具体改进建议和实施计划

### 审查评分
- **技术质量**: 1-5分评分
- **量化严谨性**: 1-5分评分
- **代码质量**: 1-5分评分
- **业务价值**: 1-5分评分
- **综合评分**: 综合评分和建议

这个审查清单确保代码质量、量化严谨性和业务价值的统一。# 代码审查清单
# Quantitative Engineering Code Review Checklist

## 🔧 技术质量审查

### 代码结构
- [ ] **单一职责原则**: 每个函数/类职责单一明确
- [ ] **函数长度**: 函数不超过50行
- [ ] **复杂度控制**: 圈复杂度 < 10
- [ ] **命名规范**: 使用描述性命名，无缩写（除广泛接受的）
- [ ] **模块化设计**: 高内聚，低耦合

### 类型安全
- [ ] **类型注解**: 100% 公共接口类型注解覆盖
- [ ] **类型检查**: mypy 检查通过，无类型错误
- [ ] **输入验证**: 所有外部输入参数类型和范围验证
- [ ] **返回值一致性**: 函数返回值类型一致

### 错误处理
- [ ] **异常处理**: 使用具体异常类型，避免裸 except
- [ ] **资源清理**: 文件、数据库连接等资源正确释放
- [ ] **优雅降级**: 错误情况下系统能够优雅降级
- [ ] **日志记录**: 关键操作和错误有适当日志记录

## 📊 量化特定审查

### 偏差防护
- [ ] **无未来函数**: 严格检查时间序列对齐，无未来数据泄露
- [ ] **幸存者偏差**: 包含退市公司历史数据
- [ ] **数据窥探防护**: 样本外验证，避免过度拟合
- [ ] **选择偏差**: 随机抽样，无选择性删除

### 统计严谨性
- [ ] **多重比较校正**: Benjamini-Hochberg FDR校正应用
- [ ] **样本量充足**: 最小样本量要求满足
- [ ] **统计方法适当**: 统计方法选择合理
- [ ] **置信区间**: 重要指标提供置信区间
- [ ] **效应大小**: 关注实际经济显著性

### 数值稳定性
- [ ] **除零保护**: 所有可能除零操作都有保护
- [ ] **数值溢出**: 大数值计算有溢出检查
- [ ] **精度控制**: 浮点数精度损失最小化
- [ ] **边界条件**: 极值和异常值处理正确

### 性能标准
- [ ] **向量化计算**: 使用 NumPy/VectorBT 操作
- [ ] **内存效率**: 内存使用符合规范 (<70% 利用率)
- [ ] **计算速度**: 关键路径 <1ms
- [ ] **缓存机制**: 重复计算结果缓存
- [ ] **批量处理**: 避免逐个处理大数据集

## 🔍 量化算法审查

### 因子计算
- [ ] **算法正确性**: 数学公式实现准确无误
- [ ] **计算逻辑**: 因子计算逻辑清晰正确
- [ ] **参数合理性**: 窗口长度、周期等参数设置合理
- [ ] **数据预处理**: 输入数据预处理完整
- [ ] **结果校验**: 因子结果与预期一致

### 技术指标
- [ ] **TA-Lib 集成**: 正确使用 TA-Lib 库函数
- [ ] **自定义指标**: 自定义指标数学计算正确
- [ ] **指标有效性**: 指标在市场中具有预测能力
- [ ] **参数优化**: 指标参数经过合理优化
- [ ] **性能优化**: 指标计算性能满足要求

### 回测系统
- [ ] **交易执行模拟**: 交易执行机制真实可靠
- [ ] **成本计算**: 包含手续费、滑点、市场冲击
- [ ] **风险控制**: 止损、仓位管理机制完善
- [ ] **时间序列一致性**: 回测时间序列准确无偏
- [ ] **结果验证**: 回测结果与理论预期一致

## 📋 业务逻辑审查

### 市场适应性
- [ ] **多市场支持**: A股、港股、美股市场适配
- [ ] **不同时间框架**: 分钟级到日线级数据处理
- [ ] **市场异常处理**: 市场异常、停牌等情况处理
- [ ] **数据源可靠性**: 数据源稳定可靠，更新及时
- [ ] **实时性要求**: 实时数据处理延迟可接受

### 交易逻辑
- [ ] **信号生成**: 买卖信号生成逻辑清晰
- [ ] **仓位管理**: 仓位计算和调整策略合理
- [ ] **止损止盈**: 止损止盈机制完善
- [ ] **资金管理**: 资金分配和风险管理策略
- [ ] **交易成本**: 交易成本影响考虑充分

## 🔄 代码质量改进

### 代码优化
- [ ] **算法优化**: 算法时间和空间复杂度优化
- [ ] **数据结构优化**: 使用合适的数据结构
- [ ] **内存优化**: 内存使用效率和垃圾回收优化
- [ ] **并行化**: 适合的并行化实现
- [ ] **缓存策略**: 合理的缓存策略设计

### 测试覆盖
- [ ] **单元测试**: 核心功能单元测试覆盖
- [ ] **集成测试**: 模块间集成测试完整
- [ ] **回归测试**: 重要功能回归测试覆盖
- [ ] **性能测试**: 关键路径性能测试
- [ ] **边界测试**: 边界条件和异常情况测试

### 文档完整性
- [ ] **API文档**: 公共接口文档完整准确
- [ ] **算法文档**: 核心算法实现原理文档
- [ ] **配置文档**: 配置参数说明文档
- [ ] **用户手册**: 使用指南和示例文档
- [ ] **更新日志**: 版本变更记录完整

## ✅ 审查结论

### 通过标准
- **技术质量**: 代码结构良好，类型安全，错误处理完善
- **量化严谨**: 统计方法正确，偏差控制严格，数值稳定
- **性能达标**: 性能指标满足要求，优化合理
- **业务合理**: 业务逻辑清晰，市场适应性良好
- **质量保证**: 测试覆盖充分，文档完整

### 需要改进
- **问题清单**: 具体问题和改进建议
- **优先级**: 问题修复优先级
- **时间计划**: 改进实施时间表
- **负责人**: 问题修复责任人
- **验证方法**: 改进效果验证方法

## 📝 审查报告

### 审查总结
- **审查范围**: 审查文件和功能模块清单
- **主要发现**: 重要问题和亮点总结
- **风险评估**: 潜在风险和影响评估
- **改进建议**: 具体改进建议和实施计划

### 审查评分
- **技术质量**: 1-5分评分
- **量化严谨性**: 1-5分评分
- **代码质量**: 1-5分评分
- **业务价值**: 1-5分评分
- **综合评分**: 综合评分和建议

这个审查清单确保代码质量、量化严谨性和业务价值的统一。