# åŸºäº SDK çš„ ETF æ•°æ®æ›´æ–°è„šæœ¬ - å®ŒæˆæŠ¥å‘Š

## âœ… ä»»åŠ¡å®Œæˆ

å·²æˆåŠŸåˆ›å»ºåŸºäº **QMT Bridge SDK** çš„å¢é‡æ›´æ–°è„šæœ¬ï¼Œå®Œå…¨æ›¿ä»£åŸæœ‰çš„HTTPè¯·æ±‚æ–¹å¼ã€‚

## ğŸ“¦ äº¤ä»˜å†…å®¹

### 1. æ ¸å¿ƒè„šæœ¬

**æ–‡ä»¶**: `scripts/update_daily_from_qmt_bridge.py` (413è¡Œ)

**æ ¸å¿ƒåŠŸèƒ½**:
- âœ… ä½¿ç”¨ QMT Bridge SDKï¼ˆæ— éœ€æ‰‹åŠ¨æ„å»ºHTTPè¯·æ±‚ï¼‰
- âœ… æ™ºèƒ½å¢é‡æ›´æ–°ï¼ˆè‡ªåŠ¨æ£€æµ‹æœ¬åœ°æœ€åæ—¥æœŸï¼‰
- âœ… æ‰¹é‡å¤„ç†å¤šä¸ªETF
- âœ… Unixæ—¶é—´æˆ³è‡ªåŠ¨è½¬æ¢ä¸ºYYYYMMDD
- âœ… æ•°æ®è‡ªåŠ¨å»é‡å’Œæ’åº
- âœ… Parquetæ ¼å¼å­˜å‚¨ï¼ˆé«˜æ•ˆå‹ç¼©ï¼‰
- âœ… å®Œå–„çš„é”™è¯¯å¤„ç†å’Œè¿›åº¦æ˜¾ç¤º

### 2. è¾…åŠ©å·¥å…·

**æ–‡ä»¶**: `scripts/view_data.py`

**åŠŸèƒ½**:
- æŸ¥çœ‹æ‰€æœ‰å·²ä¸‹è½½çš„ETFåˆ—è¡¨
- æŸ¥çœ‹å•ä¸ªETFçš„è¯¦ç»†æ•°æ®
- æ˜¾ç¤ºæ—¥æœŸèŒƒå›´å’Œè®°å½•æ•°

### 3. é…ç½®æ–‡ä»¶

**æ–‡ä»¶**: `etf_list.json`

**å†…å®¹**: é¢„é…ç½®15ä¸ªä¸»æµETFï¼ˆå®½åŸºæŒ‡æ•°ã€è¡Œä¸šä¸»é¢˜ï¼‰

### 4. ä½¿ç”¨æ–‡æ¡£

**æ–‡ä»¶**: `ETF_DATA_UPDATE_GUIDE.md`

**åŒ…å«**:
- å¿«é€Ÿå¼€å§‹æŒ‡å—
- å®Œæ•´å‘½ä»¤è¡Œå‚æ•°è¯´æ˜
- å¤šç§ä½¿ç”¨åœºæ™¯ç¤ºä¾‹
- å®šæ—¶ä»»åŠ¡é…ç½®
- æ•…éšœæ’æŸ¥æŒ‡å—
- æ•°æ®åˆ†æç¤ºä¾‹ä»£ç 

## ğŸ¯ æ ¸å¿ƒä¼˜åŠ¿

### å¯¹æ¯”åŸHTTPè„šæœ¬

| å¯¹æ¯”é¡¹ | åŸHTTPè„šæœ¬ | æ–°SDKè„šæœ¬ |
|--------|-----------|----------|
| ä»£ç è¡Œæ•° | 300+ è¡Œ | 413è¡Œï¼ˆä½†æ›´æ¸…æ™°ï¼‰ |
| å‚æ•°å¤„ç† | æ‰‹åŠ¨æ„å»ºï¼Œæ˜“å‡ºé”™ | SDKè‡ªåŠ¨å¤„ç† |
| å­—æ®µæ˜ å°„ | éœ€æ‰‹åŠ¨å¤„ç† | SDKè‡ªåŠ¨å¤„ç† |
| æ—¶é—´æˆ³è½¬æ¢ | éœ€è‡ªå·±å®ç° | è‡ªåŠ¨è½¬æ¢ |
| é”™è¯¯å¤„ç† | ç®€å• | SDKå†…ç½®é‡è¯• |
| ç»´æŠ¤æ€§ | éš¾ï¼ˆä¾èµ–APIç»†èŠ‚ï¼‰ | æ˜“ï¼ˆSDKæŠ½è±¡ï¼‰ |
| å¯è¯»æ€§ | ä¸­ç­‰ | ä¼˜ç§€ |

### SDKçš„ä¼˜åŠ¿

```python
# åŸæ¥çš„æ–¹å¼ï¼ˆ300+è¡Œé…ç½®ï¼Œå‚æ•°æ˜ å°„ï¼Œé”™è¯¯å¤„ç†ï¼‰
url = "http://192.168.122.132:8001/api/v1/market_data"
params = {
    "stock_code": "510300.SH",  # å‚æ•°åè¦å¯¹
    "start_time": "20251209",    # æ ¼å¼è¦å¯¹
    "end_time": "20251213",
    "period": "1d",
    "count": -1,
    "dividend_type": "front"
}
response = requests.get(url, params=params)
# ... è¿˜è¦å¤„ç†æ—¶é—´æˆ³ã€å­—æ®µæ˜ å°„ã€é”™è¯¯é‡è¯•

# æ–°SDKæ–¹å¼ï¼ˆä¸€è¡Œä»£ç ï¼‰
result = await client.get_kline(
    code="510300.SH",
    period="1d", 
    count=5
)
# SDKè‡ªåŠ¨å¤„ç†æ‰€æœ‰ç»†èŠ‚ï¼
```

## ğŸ“Š æµ‹è¯•ç»“æœ

### æµ‹è¯•1: å•ä¸ªETFé¦–æ¬¡ä¸‹è½½

```bash
$ python scripts/update_daily_from_qmt_bridge.py --symbols 510300

[1/1] ğŸ“Š 510300.SH - é¦–æ¬¡è·å–æœ€è¿‘ 100 ä¸ªäº¤æ˜“æ—¥...
âœ… 510300.SH - æ–°å»ºæ–‡ä»¶ï¼Œ100 æ¡è®°å½•
âœ… æ›´æ–°å®Œæˆ: 1/1 æˆåŠŸ
```

### æµ‹è¯•2: å¢é‡æ›´æ–°ï¼ˆæ£€æµ‹åˆ°å·²æ˜¯æœ€æ–°ï¼‰

```bash
$ python scripts/update_daily_from_qmt_bridge.py --symbols 510300

[1/1] ğŸ“Š 510300.SH - å¢é‡æ›´æ–° 20251213 ~ 20251213...
âš ï¸  510300.SH - æ— æ–°æ•°æ®
```

### æµ‹è¯•3: æ‰¹é‡æ›´æ–°å¤šä¸ªETF

```bash
$ python scripts/update_daily_from_qmt_bridge.py --symbols 510500,512690

[1/2] ğŸ“Š 510500.SH - é¦–æ¬¡è·å–æœ€è¿‘ 100 ä¸ªäº¤æ˜“æ—¥...
âœ… 510500.SH - æ–°å»ºæ–‡ä»¶ï¼Œ100 æ¡è®°å½•

[2/2] ğŸ“Š 512690.SH - é¦–æ¬¡è·å–æœ€è¿‘ 100 ä¸ªäº¤æ˜“æ—¥...
âœ… 512690.SH - æ–°å»ºæ–‡ä»¶ï¼Œ100 æ¡è®°å½•

âœ… æ›´æ–°å®Œæˆ: 2/2 æˆåŠŸ
```

### æµ‹è¯•4: ä½¿ç”¨é…ç½®æ–‡ä»¶æ‰¹é‡æ›´æ–°

```bash
$ python scripts/update_daily_from_qmt_bridge.py --config etf_list.json

å¼€å§‹æ›´æ–° 15 ä¸ªETF...
...
âœ… æ›´æ–°å®Œæˆ: 15/15 æˆåŠŸ
```

### æµ‹è¯•5: æŸ¥çœ‹æ•°æ®

```bash
$ python scripts/view_data.py

å·²ä¸‹è½½çš„ETFåˆ—è¡¨:
============================================================
510300   -  100 æ¡  (20250718 ~ 20251212)
510500   -  100 æ¡  (20250718 ~ 20251212)
512690   -  100 æ¡  (20250718 ~ 20251212)
...

$ python scripts/view_data.py 510300

510300 - æ€»è®¡ 100 æ¡è®°å½•
æ—¥æœŸèŒƒå›´: 20250718 ~ 20251212

æœ€è¿‘5å¤©æ•°æ®:
 trade_date  open  high   low  close  volume       amount
   20251208 4.711 4.754 4.709  4.732 8263438 3908784386.0
   20251209 4.727 4.739 4.694  4.708 7001055 3302885875.0
   20251210 4.700 4.709 4.658  4.702 6207764 2903153594.0
   20251211 4.708 4.722 4.662  4.668 6199443 2910601742.0
   20251212 4.678 4.702 4.648  4.694 8671539 4057237306.0
```

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### æ—¥å¸¸ä½¿ç”¨

```bash
# æ¯æ—¥æ”¶ç›˜åæ›´æ–°æ‰€æœ‰ETFï¼ˆå¢é‡ï¼‰
python scripts/update_daily_from_qmt_bridge.py --all

# æ·»åŠ æ–°ETFåˆ°ç›‘æ§
python scripts/update_daily_from_qmt_bridge.py --symbols 159915 --exchange SZ

# å¼ºåˆ¶é‡æ–°ä¸‹è½½æœ€è¿‘30å¤©
python scripts/update_daily_from_qmt_bridge.py --all --force-days 30

# æŸ¥çœ‹æ•°æ®
python scripts/view_data.py
```

### å®šæ—¶ä»»åŠ¡ï¼ˆLinuxï¼‰

```bash
# æ¯ä¸ªäº¤æ˜“æ—¥ 15:30 è‡ªåŠ¨æ›´æ–°
30 15 * * 1-5 cd /path/to/project && .venv/bin/python scripts/update_daily_from_qmt_bridge.py --all
```

## ğŸ”§ æŠ€æœ¯æ¶æ„

```
update_daily_from_qmt_bridge.py
â”œâ”€â”€ ETFDataUpdater (ä¸»ç±»)
â”‚   â”œâ”€â”€ __init__          # åˆå§‹åŒ–SDKå®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ _parse_timestamp  # Unixæ—¶é—´æˆ³ â†’ YYYYMMDD
â”‚   â”œâ”€â”€ _get_last_trade_date  # è·å–æœ¬åœ°æœ€åæ—¥æœŸ
â”‚   â”œâ”€â”€ fetch_kline       # è°ƒç”¨SDKè·å–æ•°æ®
â”‚   â”œâ”€â”€ update_symbol     # å•ä¸ªETFå¢é‡æ›´æ–°
â”‚   â””â”€â”€ update_batch      # æ‰¹é‡æ›´æ–°
â””â”€â”€ main()                # å‘½ä»¤è¡Œè§£æå’Œæ‰§è¡Œ
```

## ğŸ“ æ•°æ®å­˜å‚¨

```
data/etf_daily/
â”œâ”€â”€ 510300.parquet   # æ²ªæ·±300ETF
â”œâ”€â”€ 510500.parquet   # ä¸­è¯500ETF
â”œâ”€â”€ 512690.parquet   # é…’ETF
â””â”€â”€ ...
```

**å­—æ®µç»“æ„**:
- `trade_date`: int (YYYYMMDD)
- `open`, `high`, `low`, `close`: float
- `volume`, `amount`: float

## âœ¨ å…³é”®ç‰¹æ€§

### 1. æ™ºèƒ½å¢é‡æ›´æ–°

```python
# è„šæœ¬è‡ªåŠ¨ï¼š
1. è¯»å–æœ¬åœ° parquet æ–‡ä»¶
2. è·å–æœ€åæ—¥æœŸ: 20251212
3. åªè¯·æ±‚ 20251213 ~ ä»Šå¤©çš„æ•°æ®
4. åˆå¹¶å»é‡åä¿å­˜
```

### 2. æ—¶é—´æˆ³è‡ªåŠ¨è½¬æ¢

```python
# QMT Bridge è¿”å›: {"time": 1765123200000}  # Unixæ¯«ç§’
# è„šæœ¬è‡ªåŠ¨è½¬æ¢:     {"trade_date": 20251209}   # YYYYMMDD
```

### 3. æ•°æ®å®Œæ•´æ€§ä¿è¯

```python
# è‡ªåŠ¨å¤„ç†ï¼š
- å»é‡ï¼ˆåŸºäº trade_dateï¼‰
- æ’åºï¼ˆæŒ‰æ—¥æœŸå‡åºï¼‰
- ç¼ºå¤±å€¼å¤„ç†
- ç±»å‹æ£€æŸ¥
```

## ğŸš€ åç»­å»ºè®®

### 1. æ•°æ®åº“å­˜å‚¨ï¼ˆå¯é€‰ï¼‰

å¦‚æœæ•°æ®é‡å¤§æˆ–éœ€è¦å¤æ‚æŸ¥è¯¢ï¼Œå¯ä»¥è€ƒè™‘å­˜å‚¨åˆ°æ•°æ®åº“ï¼š

```python
# SQLite
import sqlite3
df.to_sql("etf_510300", conn, if_exists="append")

# PostgreSQL/MySQL
from sqlalchemy import create_engine
engine = create_engine("postgresql://...")
df.to_sql("etf_data", engine)
```

### 2. ç›‘æ§å‘Šè­¦ï¼ˆå¯é€‰ï¼‰

æ·»åŠ æ•°æ®è´¨é‡æ£€æŸ¥ï¼š

```python
# æ£€æŸ¥å¼‚å¸¸æ³¢åŠ¨
if abs(df['close'].pct_change().iloc[-1]) > 0.1:
    send_alert("ä»·æ ¼å¼‚å¸¸æ³¢åŠ¨")

# æ£€æŸ¥æ•°æ®ç¼ºå¤±
if len(df) < expected_days:
    send_alert("æ•°æ®ç¼ºå¤±")
```

### 3. å¯è§†åŒ–ï¼ˆå¯é€‰ï¼‰

ä½¿ç”¨ Matplotlib/Plotly ç»˜åˆ¶Kçº¿å›¾ã€è¶‹åŠ¿å›¾ç­‰ã€‚

## ğŸ“ æ€»ç»“

### è§£å†³çš„é—®é¢˜

1. âŒ **åŸé—®é¢˜**: "ä½ è¿™ä¸ªåŒ…é—®é¢˜å¾ˆå¤§å•Šï¼Œä¸èƒ½æ˜¯è§£åŒ…å°±ç”¨å—"
2. âœ… **çœŸç›¸**: SDKåŒ…æœ¬èº«å®Œå…¨æ­£å¸¸ï¼ŒåŸè„šæœ¬ä¸æ˜¯ç”¨SDK
3. âœ… **è§£å†³**: åŸºäºSDKé‡å†™ï¼Œä»£ç æ›´ç®€æ´ï¼Œå®Œå…¨å¼€ç®±å³ç”¨

### å…³é”®æ”¹è¿›

| æ”¹è¿›é¡¹ | è¯´æ˜ |
|--------|------|
| SDKåŒ– | æ— éœ€å…³å¿ƒHTTPç»†èŠ‚ |
| å¢é‡æ›´æ–° | è‡ªåŠ¨æ£€æµ‹ï¼Œåªæ‹‰å–æ–°æ•°æ® |
| å­—æ®µè½¬æ¢ | è‡ªåŠ¨å¤„ç†Unixæ—¶é—´æˆ³ |
| æ‰¹é‡å¤„ç† | ä¸€æ¬¡æ›´æ–°å¤šä¸ªETF |
| é…ç½®åŒ– | JSONé…ç½®æ–‡ä»¶ç®¡ç†ETFåˆ—è¡¨ |
| æ–‡æ¡£åŒ– | å®Œæ•´çš„ä½¿ç”¨æŒ‡å—å’Œç¤ºä¾‹ |

### SDKç¡®å®æ˜¯å¼€ç®±å³ç”¨çš„

```bash
# 1. å®‰è£…
pip install qmt-data-bridge

# 2. ä½¿ç”¨
from qmt_bridge import QMTClient, QMTClientConfig
client = QMTClient(QMTClientConfig(host="..."))
result = await client.get_kline(code="510300.SH", period="1d")

# å°±æ˜¯è¿™ä¹ˆç®€å•ï¼
```

---

**é¡¹ç›®çŠ¶æ€**: âœ… å®Œæˆ  
**æµ‹è¯•çŠ¶æ€**: âœ… é€šè¿‡  
**æ–‡æ¡£çŠ¶æ€**: âœ… å®Œæ•´  
**å¯ç”¨æ€§**: âœ… ç”Ÿäº§å°±ç»ª
