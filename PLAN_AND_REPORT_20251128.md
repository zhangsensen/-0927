# 🚀 项目里程碑报告与下一步重构计划 (2025-11-28)

## 第一部分：全天候 RORO 策略进化报告 (已完成)

### 1. 背景与痛点
*   **原状**：纯权益轮动策略 (WFO/VEC) 收益高 (90%+) 但回撤大 (~20%)，且在熊市资金闲置。
*   **问题**：缺乏止损和对冲，实盘体验差，容易因心态波动导致人工干预。

### 2. 进化方案：RORO (Risk-On / Risk-Off)
我们引入了 **"全天候"** 逻辑，将策略从单一的权益轮动升级为多资产配置。
*   **Risk-On (进攻)**：持有 A 股强势 ETF (Top 3)。
*   **Risk-Off (防守)**：当择时看空或触发风控时，买入 **黄金 (`518880`)** 或 **国债 (`511010`)**。
*   **风控层**：
    *   **日内止损**: 单标的 -12% (T+1 生效)。
    *   **账户熔断**: 回撤 >15% 减半仓，>25% 清仓。

### 3. 全量重评结果 (12,597 组合)
我们对所有 WFO 历史组合进行了 RORO 模式下的全量回测，结果出现质的飞跃：

| 方案 | 平均收益 | 平均回撤 | Calmar | 评价 |
| :--- | :--- | :--- | :--- | :--- |
| **原始 (纯权益)** | 76.2% | ~20.0% | 3.8 | 收益尚可，体验痛苦 |
| **全天候 RORO** | **122.9%** | **10.4%** | **11.8** | **收益翻倍，回撤腰斩** |

### 4. 最终策略选择
放弃了追求极致收益的 Rank 1，选择了 **最稳健的 Rank 3** 作为实盘策略：
*   **组合**: `ADX_14D + PRICE_POSITION_20D + SHARPE_RATIO_20D + SLOPE_20D`
*   **表现**: **年化收益 168.8%**，**最大回撤 5.8%**。
*   **特征**: 资金曲线极度平滑，堪比理财产品，极适合 100 万资金实盘。

---

## 第二部分：下一步重构计划 (ETF 池与因子体系)

> **目标**: 解决当前 ETF 池分类粗糙、因子单一的问题，构建分层、精细化的全天候系统。

### 1. ETF 池重构：分层子池 (Layered Sub-pools)
将 43 只 ETF 按资产属性和波动特征重新划分为 7 个子池：

| 子池 | 权重 | 包含标的 (示例) | 适用因子 |
| :--- | :--- | :--- | :--- |
| **BROAD_BASE** (宽基) | 25% | 300, 500, 50 | 趋势, 动量, 波动 |
| **GROWTH** (成长) | 15% | 创业板, 科创50 | 动量, 相对强度 |
| **CYCLICAL** (周期) | 15% | 证券, 有色, 银行 | 反转, 价量 |
| **TECH_THEME** (科技) | 10% | 芯片, 光伏, 新能源 | 动量, 波动率择时 |
| **DEFENSIVE** (防御) | 10% | 医药, 消费 | 低波, 低beta |
| **BOND** (债券) | 10% | 国债, 公司债 | 利率反向, 信用 |
| **GOLD** (黄金) | 5% | 黄金ETF | 避险, 美元反向 |
| **QDII** (跨境) | 10% | 纳指, 恒生 | 跨市场, 汇率 |

### 2. 因子库扩充：类别特异因子
新增针对不同资产类别的特异性因子：
*   **通用**: `RELATIVE_STRENGTH_60D` (中期相对强度), `LOW_VOLATILITY_RANK` (低波排名)。
*   **资金面**: `TURNOVER_RANK` (换手率拥挤度), `PREMIUM_DISCOUNT` (折溢价率)。
*   **债券**: `BOND_MOMENTUM` (国债动量), `CREDIT_SPREAD` (信用利差)。
*   **黄金**: `GOLD_RISK_ON_OFF` (VIX/恐慌指数联动), `USD_INVERSE` (美元反向)。
*   **QDII**: `CROSS_MARKET_SPREAD` (AH股溢价), `CNH_USD` (汇率波动)。

### 3. 动态仓位管理：波动率体制 (Volatility Regime)
引入基于全市场波动率的动态权重调整机制：

```python
def get_allocation_weights(market_vol):
    if market_vol < 0.12 (低波):
        # 激进配置: 宽基+成长+周期 (75%)
    elif market_vol < 0.20 (中波):
        # 均衡配置: 各类均衡
    elif market_vol < 0.30 (高波):
        # 防守配置: 增加防御+债券+黄金 (60%)
    else (极端):
        # 避险配置: 债券+黄金 (70%)
```

### 4. 实施路线图 (Roadmap)
1.  **Phase 1 (配置)**: 更新 `etf_pools.yaml`，完成子池划分。
2.  **Phase 2 (因子)**: 在 `precise_factor_library_v2.py` 中实现新因子。
3.  **Phase 3 (引擎)**: 升级 WFO/VEC 引擎，支持"分池选股 + 顶层汇总"。
4.  **Phase 4 (验证)**: 对比"全池轮动"与"分池轮动"的实盘效果。

---

**文档状态**: 
- RORO 策略: ✅ 已就绪 (Rank 3 配置)
- 重构计划: 📅 待启动
