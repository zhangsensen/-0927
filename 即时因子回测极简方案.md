# å³æ—¶å› å­å›æµ‹æç®€æ–¹æ¡ˆ

## èƒŒæ™¯ä¸é—®é¢˜

å½“å‰ `factor_system` é¡¹ç›®é‡‡ç”¨**æ‰¹é‡å› å­è®¡ç®— + æŒä¹…åŒ–å­˜å‚¨**çš„è®¾è®¡ï¼Œé€‚åˆå› å­ç ”ç©¶ï¼Œä½†å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š

- å­˜å‚¨çˆ†ç‚¸ï¼š154 åˆ— Ã— è‚¡ç¥¨æ•° Ã— æ—¥æœŸæ•°
- å› å­æ–‡ä»¶å†—ä½™ï¼šå¤§é‡æœªé€šè¿‡æ˜¾è‘—æ€§æ£€éªŒçš„å› å­ä¹Ÿè¢«å­˜å‚¨
- å›æµ‹å¤æ‚æ€§ï¼šéœ€è¦ä»å› å­æ–‡ä»¶ä¸­è¯»å–ã€å¯¹é½ã€èåˆ

## æç®€æ–¹æ¡ˆæ ¸å¿ƒæ€æƒ³

**å³æ—¶è®¡ç®—ã€ç®—å®Œå³èµ°ã€ä¸å­˜å‚¨å› å­**

- æ¯ä¸ªè‚¡ç¥¨åœ¨å›æµ‹æ—¶å³æ—¶è®¡ç®— 154 å› å­
- åªä¿ç•™é€šè¿‡æ˜¾è‘—æ€§æ£€éªŒçš„æœ‰æ•ˆå› å­
- æ— æŒä¹…åŒ–å› å­å­˜å‚¨ï¼Œé¿å…å­˜å‚¨çˆ†ç‚¸

## æ¶æ„è®¾è®¡

### æ–¹æ¡ˆé€‰æ‹©ï¼šç ”ç©¶ & å›æµ‹åˆ†ç¦»

```
factor_system/          # ä¿æŒç°çŠ¶ï¼Œç”¨äºå› å­ç ”ç©¶
â”‚
â””â”€ hk_midfreq/          # æ–°çš„æç®€å›æµ‹ç³»ç»Ÿ
   â”œâ”€ price_loader.py                 # âœ… å·²æœ‰
   â”œâ”€ on_the_fly_factor_engine.py    # ğŸ†• å³æ—¶å› å­è®¡ç®—å¼•æ“
   â”œâ”€ strategy_core.py               # âœ… å·²æœ‰ï¼Œéœ€æ”¹é€ 
   â””â”€ multi_factor_strategy.py       # âœ… å·²æœ‰ï¼Œéœ€æ”¹é€ 
```

**ä¼˜ç‚¹**ï¼š
- ä¸ç ´åç°æœ‰ `factor_system` çš„ç ”ç©¶ä»·å€¼
- ç”¨é€”åˆ†ç¦»ï¼šç ”ç©¶å½’ç ”ç©¶ï¼Œå›æµ‹å½’å›æµ‹
- æœ€å°æ”¹åŠ¨ï¼Œæ–°å¢æ¨¡å—å³å¯å®ç°

## å®ç°è®¡åˆ’

### ç¬¬ä¸€æ­¥ï¼šæ–°å¢å³æ—¶å› å­å¼•æ“

**æ–‡ä»¶**ï¼š`hk_midfreq/on_the_fly_factor_engine.py`

**åŠŸèƒ½**ï¼š
- è°ƒç”¨ `factor_system.factor_generation` çš„ 154 æŒ‡æ ‡å‡½æ•°
- å³æ—¶è®¡ç®—æ‰€æœ‰å› å­
- è¿‡æ˜¾è‘—æ€§æ£€éªŒï¼ˆIC åˆ†æï¼‰
- åªè¿”å›æœ‰æ•ˆå› å­ï¼ˆå¯é€‰å‰ N åï¼‰

**æ¥å£è®¾è®¡**ï¼š
```python
class OnTheFlyFactorEngine:
    def compute_factors(self, price_df: pd.DataFrame, symbol: str) -> pd.DataFrame:
        """
        å³æ—¶è®¡ç®—å› å­å¹¶è¿‡æ»¤
        
        Args:
            price_df: OHLCV æ•°æ®
            symbol: è‚¡ç¥¨ä»£ç 
            
        Returns:
            æœ‰æ•ˆå› å­ DataFrame
        """
        pass
```

### ç¬¬äºŒæ­¥ï¼šæ”¹é€ å¤šå› å­ç­–ç•¥

**æ–‡ä»¶**ï¼š`hk_midfreq/multi_factor_strategy.py`

**æ”¹åŠ¨**ï¼š
- ç§»é™¤å› å­æ–‡ä»¶åŠ è½½é€»è¾‘
- æ”¹ä¸ºè°ƒç”¨ `OnTheFlyFactorEngine`
- ä¿æŒä»·æ ¼åŠ è½½é€»è¾‘ä¸å˜

**æ”¹åŠ¨å‰åå¯¹æ¯”**ï¼š
```python
# æ”¹åŠ¨å‰
factor_df = self.load_factor_file(symbol, timeframe)
merged_df = pd.concat([price_df, factor_df], axis=1)

# æ”¹åŠ¨å
factor_engine = OnTheFlyFactorEngine()
factor_df = factor_engine.compute_factors(price_df, symbol)
merged_df = pd.concat([price_df, factor_df], axis=1)
```

### ç¬¬ä¸‰æ­¥ï¼šä¼˜åŒ–ä¸éªŒè¯

- æ€§èƒ½æµ‹è¯•ï¼šå•åªè‚¡ç¥¨å³æ—¶è®¡ç®—æ—¶é—´
- éªŒè¯æµ‹è¯•ï¼šä¸åŸæœ‰å› å­è®¡ç®—ç»“æœä¸€è‡´æ€§
- å†…å­˜ä¼˜åŒ–ï¼šç¡®ä¿è®¡ç®—ååŠæ—¶é‡Šæ”¾å†…å­˜

## æŠ€æœ¯å®ç°ç»†èŠ‚

### å³æ—¶å› å­è®¡ç®—æµç¨‹

```python
def compute_factors(self, price_df: pd.DataFrame, symbol: str) -> pd.DataFrame:
    # 1. è°ƒç”¨ factor_system ç”Ÿæˆæ‰€æœ‰ 154 å› å­
    all_factors = self._generate_all_factors(price_df)
    
    # 2. æ˜¾è‘—æ€§æ£€éªŒ
    significant_factors = self._significance_test(all_factors, price_df)
    
    # 3. é€‰æ‹©æœ‰æ•ˆå› å­
    valid_factors = self._select_valid_factors(significant_factors)
    
    return valid_factors
```

### æ˜¾è‘—æ€§æ£€éªŒå‚æ•°

- IC åˆ†æçª—å£ï¼š20 æ—¥æ»šåŠ¨çª—å£
- æ˜¾è‘—æ€§é˜ˆå€¼ï¼šp < 0.05
- å› å­æ•°é‡é™åˆ¶ï¼šæœ€å¤šä¿ç•™å‰ 20 ä¸ªæœ‰æ•ˆå› å­

### æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

- ç¼“å­˜å› å­å‡½æ•°å¯¹è±¡ï¼Œé¿å…é‡å¤å¯¼å…¥
- ä½¿ç”¨ numba åŠ é€Ÿå…³é”®è®¡ç®—
- åŠæ—¶æ¸…ç†ä¸­é—´å˜é‡ï¼Œæ§åˆ¶å†…å­˜ä½¿ç”¨

## ä¼˜åŠ¿åˆ†æ

### âœ… å·¥ç¨‹ä¼˜åŠ¿

1. **æç®€å­˜å‚¨**ï¼šæ— å› å­æ–‡ä»¶ï¼Œæ— å­˜å‚¨çˆ†ç‚¸
2. **çœŸå®æ¨¡æ‹Ÿ**ï¼šåƒå®ç›˜ä¸€æ ·å³æ—¶è®¡ç®—å› å­
3. **çµæ´»å®éªŒ**ï¼šéšæ—¶è°ƒæ•´å› å­é€»è¾‘ï¼Œæ— éœ€æ¸…åº“
4. **æ‰©å±•æ€§å¼º**ï¼šåŠ å‡ åƒä¸ªè‚¡ç¥¨ä¹Ÿä¸æ€•

### âœ… é‡åŒ–ä¼˜åŠ¿

1. **é¿å…æœªæ¥å‡½æ•°**ï¼šæ¯åªè‚¡ç¥¨ç‹¬ç«‹è®¡ç®—ï¼Œæ— äº¤å‰æ±¡æŸ“
2. **çœŸå®å›æµ‹**ï¼šå› å­ä¸ä»·æ ¼ä¸¥æ ¼å¯¹é½
3. **å‚æ•°çµæ´»**ï¼šæ˜¾è‘—æ€§é˜ˆå€¼å¯åŠ¨æ€è°ƒæ•´

## é£é™©ä¸æ³¨æ„äº‹é¡¹

### âš ï¸ è®¡ç®—æ€§èƒ½

- æ¯åªè‚¡ç¥¨éƒ½è¦è®¡ç®— 154 å› å­ï¼Œéœ€è¦ä¼˜åŒ–æ€§èƒ½
- å»ºè®®ä½¿ç”¨ numba åŠ é€Ÿï¼Œé¿å… Python å¾ªç¯

### âš ï¸ å› å­ä¸€è‡´æ€§

- ç¡®ä¿å³æ—¶å› å­è®¡ç®—ä¸ factor_system ç»“æœä¸€è‡´
- éœ€è¦åšä¸€è‡´æ€§éªŒè¯æµ‹è¯•

### âš ï¸ å†…å­˜ç®¡ç†

- åŠæ—¶é‡Šæ”¾è®¡ç®—è¿‡ç¨‹ä¸­çš„ä¸­é—´å˜é‡
- ç›‘æ§å†…å­˜ä½¿ç”¨ï¼Œé¿å…å†…å­˜æ³„æ¼

## å®æ–½æ—¶é—´çº¿

### ç¬¬ä¸€é˜¶æ®µï¼ˆ1-2 å¤©ï¼‰
- [ ] å®ç° `OnTheFlyFactorEngine` åŸºç¡€æ¡†æ¶
- [ ] è°ƒç”¨ factor_system æŒ‡æ ‡å‡½æ•°
- [ ] åŸºç¡€æ˜¾è‘—æ€§æ£€éªŒ

### ç¬¬äºŒé˜¶æ®µï¼ˆ1 å¤©ï¼‰
- [ ] æ”¹é€  `multi_factor_strategy.py`
- [ ] ç§»é™¤å› å­æ–‡ä»¶åŠ è½½
- [ ] é›†æˆå³æ—¶å› å­å¼•æ“

### ç¬¬ä¸‰é˜¶æ®µï¼ˆ1 å¤©ï¼‰
- [ ] æ€§èƒ½æµ‹è¯•ä¸ä¼˜åŒ–
- [ ] ä¸€è‡´æ€§éªŒè¯
- [ ] æ–‡æ¡£æ›´æ–°

## é•¿æœŸæ¼”è¿›

### å¯é€‰ä¼˜åŒ–æ–¹å‘

1. **è½»é‡ç¼“å­˜**ï¼šç¼“å­˜å› å­è®¡ç®—ç»“æœï¼Œé¿å…é‡å¤è®¡ç®—
2. **å¹¶è¡Œè®¡ç®—**ï¼šå¤šè‚¡ç¥¨å¹¶è¡Œè®¡ç®—å› å­
3. **å¢é‡è®¡ç®—**ï¼šåªè®¡ç®—æ–°å¢æ—¥æœŸçš„å› å­

### æ‰©å±•å¯èƒ½æ€§

- æ”¯æŒå¤šç§å› å­è®¡ç®—å¼•æ“
- æ”¯æŒå®æ—¶å› å­è®¡ç®—
- é›†æˆæœºå™¨å­¦ä¹ å› å­ç­›é€‰

## ç»“è®º

è¿™ä¸ªæç®€æ–¹æ¡ˆéµå¾ª Linus å¼å·¥ç¨‹å“²å­¦ï¼š

- **æ¶ˆç­å¤æ‚æ€§**ï¼šå»æ‰å› å­å­˜å‚¨ï¼Œç›´æ¥å³æ—¶è®¡ç®—
- **å®ç”¨ä¸»ä¹‰**ï¼šè§£å†³çœŸå®é—®é¢˜ï¼Œé¿å…è¿‡åº¦è®¾è®¡
- **API å…¼å®¹æ€§**ï¼šä¿æŒç°æœ‰ç­–ç•¥æ¥å£ä¸å˜
- **ç®€æ´æ‰§å¿µ**ï¼šæœ€å°‘çš„ä»£ç å®ç°æœ€å¤§çš„åŠŸèƒ½

æ¨èç«‹å³å®æ–½è¿™ä¸ªæ–¹æ¡ˆï¼Œå®ç°çœŸæ­£çš„æç®€é‡åŒ–å›æµ‹ç³»ç»Ÿã€‚