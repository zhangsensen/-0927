# ETF轮动回测引擎 - 文件夹使用说明

## 文件夹组织结构

每个回测都会创建一个独立的时间戳文件夹来组织所有输出文件：

```
/Users/zhangshenshen/深度量化0927/etf_rotation_system/data/results/backtest/
├── backtest_20251020_185942/          # 时间戳文件夹
│   ├── backtest.log                 # 执行日志
│   ├── results.csv                  # 回测结果数据
│   └── best_config.json            # 最优策略配置
└── backtest_20251020_190045/          # 另一个回测
    ├── backtest.log                 # 执行日志
    ├── results.csv                  # 回测结果数据
    └── best_config.json            # 最优策略配置
```

## 使用方法

### 1. 创建新的回测（默认行为）
```bash
python3 backtest_engine_configurable.py --config backtest_config_memory_safe.yaml
```
- 自动创建新的时间戳文件夹
- 文件夹格式：`backtest_YYYYMMDD_HHMMSS`

### 2. 重用现有文件夹
```bash
python3 backtest_engine_configurable.py \
  --config backtest_config_memory_safe.yaml \
  --output-dir "/Users/zhangshenshen/深度量化0927/etf_rotation_system/data/results/backtest/backtest_20251020_185942"
```
- 使用指定的现有文件夹
- 新的运行结果会覆盖同名的文件（如 `results.csv`, `best_config.json`）
- 日志会追加到现有的 `backtest.log` 文件中

### 3. 常用命令示例

**创建新回测：**
```bash
# 使用默认配置
python3 backtest_engine_configurable.py

# 使用指定配置
python3 backtest_engine_configurable.py --config my_config.yaml

# 使用指定面板文件
python3 backtest_engine_configurable.py --panel /path/to/panel.parquet
```

**重用现有文件夹：**
```bash
# 重用最近的回测文件夹
python3 backtest_engine_configurable.py --output-dir /path/to/backtest_20251020_185942

# 重用文件夹并指定配置
python3 backtest_engine_configurable.py \
  --config my_config.yaml \
  --output-dir /path/to/backtest_20251020_185942
```

## 文件说明

### backtest.log
- 包含详细的执行日志
- 记录时间戳、配置信息、数据加载情况、回测进度等
- 每次运行都会记录开始时间和执行状态

### results.csv
- 完整的回测结果数据
- 包含所有测试组合的性能指标
- 字段：weights, top_n, total_return, sharpe_ratio, max_drawdown, final_value, turnover

### best_config.json
- 最优策略的详细配置
- 包含权重配置、性能指标、使用的因子、配置参数等
- 可用于重现最优策略或进一步分析

## 优势

1. **避免文件混乱**：每个回测都有独立的文件夹，不会相互干扰
2. **便于管理**：可以轻松比较不同回测的结果
3. **支持重用**：可以在现有文件夹中继续测试，适合参数调优
4. **完整记录**：所有相关文件都保存在一起，便于回溯和分析

## 注意事项

- 重用现有文件夹时，`results.csv` 和 `best_config.json` 会被覆盖
- `backtest.log` 会追加新的日志内容，保留历史记录
- 建议在进行重要回测前备份有价值的结果文件夹